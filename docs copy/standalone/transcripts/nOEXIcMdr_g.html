<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>nOEXIcMdr_g</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/nOEXIcMdr_g?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="0.56" data-end="3.41">[Music]</span> <span data-start="3.41" data-end="6.14">[Applause]</span> <span data-start="6.14" data-end="12.52">[Music]</span> <span data-start="12.53" data-end="15.809">hey there I'm Ben Morse I'm a developer</span> <span data-start="15.809" data-end="18.21">advocate working on the web and on amps</span> <span data-start="18.21" data-end="20.369">and I'm crystal Lambert technically a</span> <span data-start="20.369" data-end="22.529">writer working for the web on the ant</span> <span data-start="22.529" data-end="24.359">project we're here to talk about</span> <span data-start="24.359" data-end="25.8">something we think it's pretty cool</span> <span data-start="25.8" data-end="28.05">a new way to run javascript in web</span> <span data-start="28.05" data-end="30.9">workers with amp awesome let's get</span> <span data-start="30.9" data-end="33.649">started but then what is this slide</span> <span data-start="33.649" data-end="37.17">JavaScript foe I love JavaScript it lets</span> <span data-start="37.17" data-end="38.82">me do whatever I want</span> <span data-start="38.82" data-end="41.28">sure javascript is amazing Ismay the</span> <span data-start="41.28" data-end="43.59">modern web possible but we both know</span> <span data-start="43.59" data-end="45.27">that many websites are too slow and</span> <span data-start="45.27" data-end="47.28">that's partially caused by lots of</span> </p>
<p><span data-start="47.28" data-end="49.32">JavaScript this one of the reasons like</span> <span data-start="49.32" data-end="50.7">people like this are staring at their</span> <span data-start="50.7" data-end="52.68">phones waiting for our sites to load</span> <span data-start="52.68" data-end="54.449">yeah that's no good</span> <span data-start="54.449" data-end="56.789">you think the more JavaScript the better</span> <span data-start="56.789" data-end="59.19">I could write more code to make things</span> <span data-start="59.19" data-end="60.989">quicker well it's like too much ice</span> <span data-start="60.989" data-end="63.329">cream or time spent at home you don't</span> <span data-start="63.329" data-end="66.21">want to overdo it well what about these</span> <span data-start="66.21" data-end="68.49">web workers I hear you can use them to</span> <span data-start="68.49" data-end="71.25">get JavaScript off the main thread but</span> </p>
<p><span data-start="71.25" data-end="73.32">I'm not sure how to get started yeah it</span> <span data-start="73.32" data-end="75.24">can be pretty intimidating because the</span> <span data-start="75.24" data-end="78.24">and another thing amp doesn't let me</span> <span data-start="78.24" data-end="80.909">write my own JavaScript period huh</span> <span data-start="80.909" data-end="83.4">can we make a video about that â€” well</span> <span data-start="83.4" data-end="85.409">conveniently crystal this video can be</span> <span data-start="85.409" data-end="87.63">about both those things because Anthony</span> <span data-start="87.63" data-end="90.329">provides an easy way to use workers so</span> <span data-start="90.329" data-end="91.409">we're going to show JavaScript</span> <span data-start="91.409" data-end="93.03">developers how amp makes it easy to try</span> <span data-start="93.03" data-end="95.7">web workers and people are already using</span> <span data-start="95.7" data-end="97.35">apt I'll show how you can write your own</span> <span data-start="97.35" data-end="98.67">JavaScript without breaking apps</span> <span data-start="98.67" data-end="102.06">performance guarantees for everyone is a</span> <span data-start="102.06" data-end="103.409">nice way to run JavaScript</span> <span data-start="103.409" data-end="104.67">anyway it's unlikely to harm your web</span> <span data-start="104.67" data-end="107.49">vital scores oh yeah I'm hearing lots</span> <span data-start="107.49" data-end="112.53">about this Web vitals that's uh our page</span> <span data-start="112.53" data-end="114.84">is first input delay largest content</span> <span data-start="114.84" data-end="117">full pay and cumulative layout shift</span> <span data-start="117" data-end="119.759">right those are the three so let's get</span> <span data-start="119.759" data-end="120.27">going</span> <span data-start="120.27" data-end="123.39">another slide what is this a guy</span> <span data-start="123.39" data-end="125.369">knitting yeah it's a transition slide</span> <span data-start="125.369" data-end="129.239">well it does remind me why is the web</span> <span data-start="129.239" data-end="131.039">single threaded</span> </p>
<p><span data-start="131.039" data-end="133.709">I mean every modern OS has multiple</span> <span data-start="133.709" data-end="136.739">threads why hasn't the web caught it</span> <span data-start="136.739" data-end="138.87">honestly it's just how browsers and</span> <span data-start="138.87" data-end="141.239">JavaScript have always been I mean of</span> <span data-start="141.239" data-end="142.56">course modern browsers can multitask</span> <span data-start="142.56" data-end="144.599">they can't be more than one thing at a</span> <span data-start="144.599" data-end="145.17">time</span> <span data-start="145.17" data-end="146.969">but each browser to have as a single</span> <span data-start="146.969" data-end="149.43">thread for the UI only one process can</span> <span data-start="149.43" data-end="151.53">make changes to the screen at a time</span> <span data-start="151.53" data-end="153.629">that means JavaScript can block the</span> <span data-start="153.629" data-end="156.12">browser from doing things and vice versa</span> <span data-start="156.12" data-end="157.379">but wait</span> <span data-start="157.379" data-end="160.409">javascript is asynchronous right so</span> <span data-start="160.409" data-end="162.659">whenever an event gets fired doesn't the</span> <span data-start="162.659" data-end="164.67">event handlers code start running right</span> <span data-start="164.67" data-end="167.31">away well sure but all the code in a web</span> <span data-start="167.31" data-end="169.739">page still runs in a single thread this</span> <span data-start="169.739" data-end="171.93">diagram illustrates JavaScript event</span> <span data-start="171.93" data-end="174.989">loop so the browser fires an event you</span> <span data-start="174.989" data-end="177.15">have an event handler that code runs</span> <span data-start="177.15" data-end="179.7">until it's done as other events fire</span> <span data-start="179.7" data-end="183.689">they get added to a queue mmm I see so</span> <span data-start="183.689" data-end="185.549">if my code is handling one event and</span> <span data-start="185.549" data-end="188.73">another event fires the browser just</span> <span data-start="188.73" data-end="191.25">can't spin up another thread instead it</span> <span data-start="191.25" data-end="192.84">has to wait for that event in the queue</span> <span data-start="192.84" data-end="195.18">right it has to wait until the current</span> <span data-start="195.18" data-end="197.76">code is done let's say the user taps a</span> <span data-start="197.76" data-end="199.29">button while your code is running a long</span> <span data-start="199.29" data-end="202.109">task well a JavaScript can't handle it</span> <span data-start="202.109" data-end="203.97">any other event until your task</span> <span data-start="203.97" data-end="206.79">completes so the next bit of code will</span> <span data-start="206.79" data-end="209.76">be delayed we're still the browser may</span> <span data-start="209.76" data-end="211.53">be unable to change the UI because it's</span> <span data-start="211.53" data-end="214.229">waiting for your code I guess if it</span> <span data-start="214.229" data-end="215.79">weren't that way everything would just</span> <span data-start="215.79" data-end="218.22">be fighting for control over the dom and</span> <span data-start="218.22" data-end="220.62">you'd have race conditions and general</span> <span data-start="220.62" data-end="223.47">cam oh yeah and unfortunately to make</span> </p>
<p><span data-start="223.47" data-end="225.479">JavaScript thread safe we'd have to</span> <span data-start="225.479" data-end="227.699">completely rewrite it all right this is</span> <span data-start="227.699" data-end="231.06">making some sense not only can excessive</span> <span data-start="231.06" data-end="232.859">JavaScript make your page slow to load</span> <span data-start="232.859" data-end="235.349">it can also make the page slow to</span> <span data-start="235.349" data-end="238.26">respond to users interactions I'm</span> <span data-start="238.26" data-end="239.879">guessing this is where web workers</span> <span data-start="239.879" data-end="242.729">coming yes javascript in a web worker</span> <span data-start="242.729" data-end="245.04">runs in a different thread and this is</span> <span data-start="245.04" data-end="247.109">not a new idea where brokers have been</span> <span data-start="247.109" data-end="250.65">around for about 10 years okay 10 years</span> <span data-start="250.65" data-end="252.659">that's longer than I've been working on</span> <span data-start="252.659" data-end="255.239">the web why am I just learning about</span> <span data-start="255.239" data-end="257.22">them I think because they're limited</span> <span data-start="257.22" data-end="259.62">made them harder to use workers can't</span> <span data-start="259.62" data-end="261.359">cause race conditions with other workers</span> <span data-start="261.359" data-end="264.06">or the main thread because they lack ax</span> <span data-start="264.06" data-end="267.09">padam or the global scope instead</span> <span data-start="267.09" data-end="268.8">auricular communicates with the main</span> <span data-start="268.8" data-end="270.33">thread by passing messages back and</span> <span data-start="270.33" data-end="272.76">forth each message contains an object</span> <span data-start="272.76" data-end="274.74">there are light rays that make this</span> <span data-start="274.74" data-end="277.8">simpler notably calm linked by Surma and</span> <span data-start="277.8" data-end="280.5">worker eyes by Jason Miller but workers</span> <span data-start="280.5" data-end="284.19">can't access the Dom so workers are</span> <span data-start="284.19" data-end="286.53">great for doing long tasks off the main</span> <span data-start="286.53" data-end="289.11">thread but what if you want access to</span> <span data-start="289.11" data-end="291.81">the Dom that's a big obstacle and that's</span> <span data-start="291.81" data-end="293.669">where I am script comes to the rescue</span> </p>
<p><span data-start="293.669" data-end="295.74">I knew at some point we were gonna bring</span> <span data-start="295.74" data-end="300.09">amp into this we did so in 2018 the amp</span> <span data-start="300.09" data-end="301.74">project released an open source library</span> <span data-start="301.74" data-end="304.56">called worker Dom worker Dom makes a</span> <span data-start="304.56" data-end="306.21">copy of the Dom for the workers use</span> <span data-start="306.21" data-end="309.27">worker Dom also recreates a subset of</span> <span data-start="309.27" data-end="311.7">the standard Dom API this lets the</span> <span data-start="311.7" data-end="313.56">worker manipulate the DOM and make</span> <span data-start="313.56" data-end="315.63">changes on the page using standard</span> <span data-start="315.63" data-end="318.27">techniques worker Dom keeps the copy of</span> <span data-start="318.27" data-end="320.81">the DOM and the real Dom in sync so</span> <span data-start="320.81" data-end="323.82">something changes in the real Dom worker</span> </p>
<p><span data-start="323.82" data-end="325.8">Dom sends a message to the worker to</span> <span data-start="325.8" data-end="328.5">make that change and the copy and if</span> <span data-start="328.5" data-end="330.539">your record changes its copy worker Dom</span> <span data-start="330.539" data-end="332.46">sends a message over to the real DOM and</span> <span data-start="332.46" data-end="334.5">the same change gets made there</span> <span data-start="334.5" data-end="337.95">so I heard you say amp is all this only</span> <span data-start="337.95" data-end="340.05">true for amp or can I use worker dawn</span> <span data-start="340.05" data-end="342.27">with a different stack you can import</span> <span data-start="342.27" data-end="344.07">worker Dhamma to your own project but</span> <span data-start="344.07" data-end="346.86">worker Dom is super useful for amp since</span> <span data-start="346.86" data-end="348.63">it provides a way to run JavaScript in a</span> <span data-start="348.63" data-end="350.97">sandbox where it can't run rampant and</span> <span data-start="350.97" data-end="354">break amps performance guarantees and</span> <span data-start="354" data-end="355.8">encapsulate swagger Dom in a component</span> <span data-start="355.8" data-end="358.86">called amp script this is a little</span> <span data-start="358.86" data-end="362.22">abstract can you show me some code code</span> </p>
<p><span data-start="362.22" data-end="366.66">I understand ok fine let's make a basic</span> <span data-start="366.66" data-end="368.61">hello world example with Apps Script in</span> <span data-start="368.61" data-end="371.19">the body we inserted an amp script</span> <span data-start="371.19" data-end="373.47">components the Dhamma contains gets</span> <span data-start="373.47" data-end="375.93">passed to the worker so here to the</span> <span data-start="375.93" data-end="378.479">worker that entire DOM is that h1 tag</span> <span data-start="378.479" data-end="380.93">next we put our code in a script tag</span> <span data-start="380.93" data-end="383.039">whoa that's weird</span> <span data-start="383.039" data-end="386.4">you set the type to plain text instead</span> <span data-start="386.4" data-end="389.16">of text JavaScript yeah we did that's</span> <span data-start="389.16" data-end="390.3">what the browser won't see it as</span> <span data-start="390.3" data-end="392.27">JavaScript and just executed immediately</span> <span data-start="392.27" data-end="395.25">instead an script finds the coda puts</span> <span data-start="395.25" data-end="397.79">into a worker so the code in this script</span> <span data-start="397.79" data-end="400.19">grabs the first h1 tag in the DOM and</span> <span data-start="400.19" data-end="402.53">appends a comma and the word world</span> <span data-start="402.53" data-end="405.74">right on page load and does that work</span> <span data-start="405.74" data-end="410.06">look magic that was pretty quick let's</span> <span data-start="410.06" data-end="414.32">watch it again I'm overwhelmed well okay</span> <span data-start="414.32" data-end="416.51">it's not Gmail but that world was really</span> <span data-start="416.51" data-end="419.24">and truly added by a web worker can you</span> <span data-start="419.24" data-end="419.75">prove it</span> <span data-start="419.75" data-end="422.72">if we open dev tools and go to the</span> <span data-start="422.72" data-end="425.21">sources tab and click over here we can</span> <span data-start="425.21" data-end="427.1">see our script right under the code</span> <span data-start="427.1" data-end="429.65">added by M script okay that's kind of</span> <span data-start="429.65" data-end="431.69">cool here's how that looks in a full web</span> <span data-start="431.69" data-end="433.49">page I have looked some things out for</span> <span data-start="433.49" data-end="435.53">simplicity's sake but you can see that</span> <span data-start="435.53" data-end="437.78">as with all amp pages were loading amps</span> <span data-start="437.78" data-end="440.15">runtime scripts we're also including the</span> </p>
<p><span data-start="440.15" data-end="441.5">JavaScript that makes the Emma scripts</span> <span data-start="441.5" data-end="444.89">work so do you always have to include</span> <span data-start="444.89" data-end="447.41">your JavaScript in line like that it's</span> <span data-start="447.41" data-end="450.14">not really a best practice yeah that's a</span> <span data-start="450.14" data-end="452.15">good point we can also store the</span> </p>
<p><span data-start="452.15" data-end="454.49">JavaScript in his own file by using am</span> <span data-start="454.49" data-end="457.76">scripts source attribute like this so</span> <span data-start="457.76" data-end="460.61">that example works but it's not really</span> <span data-start="460.61" data-end="463.58">that useful could we say add that world</span> <span data-start="463.58" data-end="466.76">when the user presses a button okay fine</span> <span data-start="466.76" data-end="469.25">let's add your HTML a button that says</span> <span data-start="469.25" data-end="472.16">hello who will write JavaScript that</span> <span data-start="472.16" data-end="474.35">grabs that button and adds a handler for</span> <span data-start="474.35" data-end="475.91">the click event when you click the</span> <span data-start="475.91" data-end="478.73">button it works its magic let's try it</span> <span data-start="478.73" data-end="481.85">out so there's hello there's our button</span> <span data-start="481.85" data-end="485.87">and look hello world okay let's go a</span> <span data-start="485.87" data-end="489.98">little crazy super neato what else can</span> <span data-start="489.98" data-end="490.4">we do</span> <span data-start="490.4" data-end="493.19">does am script let us do a fetch does it</span> <span data-start="493.19" data-end="495.16">ever hears that hello world example</span> <span data-start="495.16" data-end="497.75">modified to retrieve the word world from</span> <span data-start="497.75" data-end="500.54">an endpoint workers natively support</span> <span data-start="500.54" data-end="503.75">fetch XML HTTP requests and even</span> </p>
<p><span data-start="503.75" data-end="504.47">WebSockets</span> <span data-start="504.47" data-end="508.07">okay this is getting pretty cool but</span> <span data-start="508.07" data-end="509.09">this is amp right</span> <span data-start="509.09" data-end="511.43">how does amp just let me write any</span> <span data-start="511.43" data-end="513.41">JavaScript I want well that's a good</span> <span data-start="513.41" data-end="513.89">point</span> <span data-start="513.89" data-end="516.11">amp tries hard to guarantee you low</span> <span data-start="516.11" data-end="518.419">cumulative layout shift to keep page</span> <span data-start="518.419" data-end="521.09">elements from moving around if your code</span> <span data-start="521.09" data-end="522.74">makes mutations to the page that would</span> <span data-start="522.74" data-end="524.21">really disturb the page layout and</span> <span data-start="524.21" data-end="526.16">preserves the right to disallow those</span> <span data-start="526.16" data-end="529.22">changes or even shut the worker down if</span> <span data-start="529.22" data-end="530.96">you're on script container can't change</span> <span data-start="530.96" data-end="533.48">it can't disturb the page as much and</span> <span data-start="533.48" data-end="535.85">that gives you more freedom that's why I</span> <span data-start="535.85" data-end="537.47">specified the height and width here in</span> <span data-start="537.47" data-end="539.87">the HTML and why I didn't choose amps</span> <span data-start="539.87" data-end="542.18">container layout there's a lot to this</span> <span data-start="542.18" data-end="544.22">so check the documentation on amp dough</span> <span data-start="544.22" data-end="548.03">for details hold on can I just use amp</span> <span data-start="548.03" data-end="549.98">script to inject more scripts into the</span> </p>
<p><span data-start="549.98" data-end="552.71">DOM nope you're working with virtual Dom</span> <span data-start="552.71" data-end="554.36">not gonna work</span> <span data-start="554.36" data-end="556.88">fair enough but I see something about</span> <span data-start="556.88" data-end="558.68">not allowing more than a hundred and</span> <span data-start="558.68" data-end="561.11">fifty kilobytes of JavaScript is that on</span> <span data-start="561.11" data-end="563.81">a page level that's right 150 K is per</span> <span data-start="563.81" data-end="566.15">page but I could still fit jQuery into</span> <span data-start="566.15" data-end="568.64">that and up I can just copy in my</span> <span data-start="568.64" data-end="570.35">favorite image slider and charter</span> <span data-start="570.35" data-end="572.09">libraries well remember the word Kadam</span> <span data-start="572.09" data-end="574.1">is recreated um API that supports in its</span> <span data-start="574.1" data-end="576.41">own JavaScript if we're Kodama supported</span> <span data-start="576.41" data-end="578.69">the whole Dom API it would be cumbersome</span> <span data-start="578.69" data-end="580.67">and huge it would slow down pages</span> <span data-start="580.67" data-end="582.56">enormous ly it's a pretty few</span> <span data-start="582.56" data-end="584.24">third-party libraries are going to work</span> <span data-start="584.24" data-end="588.17">right out of the box okay and what's the</span> <span data-start="588.17" data-end="590.33">best way to use Apps Script well one way</span> <span data-start="590.33" data-end="591.86">is to use vanilla JavaScript while</span> <span data-start="591.86" data-end="593.45">keeping an eye on this table of</span> <span data-start="593.45" data-end="595.7">supported api's there is quite a bit</span> <span data-start="595.7" data-end="596.32">there</span> <span data-start="596.32" data-end="601.34">wait react can I use react yes that's</span> <span data-start="601.34" data-end="603.59">the other way react uses a very specific</span> <span data-start="603.59" data-end="606.47">subset of the Dom API so the worker Dom</span> <span data-start="606.47" data-end="608.15">teammates sure that subset is well</span> <span data-start="608.15" data-end="611.6">supported okay but I've used react</span> <span data-start="611.6" data-end="614.6">before my react bundle might need to</span> <span data-start="614.6" data-end="616.04">break that hundred and fifty kilobyte</span> <span data-start="616.04" data-end="617.75">limit yeah that's why it's probably</span> <span data-start="617.75" data-end="620.93">better to use pre act instead pre act as</span> <span data-start="620.93" data-end="623.03">highly compatible with react but it's</span> <span data-start="623.03" data-end="625.91">only three K minified in gzipped for</span> <span data-start="625.91" data-end="628.1">projects with more code pre actives</span> <span data-start="628.1" data-end="631.19">probably the way to go here I've made</span> <span data-start="631.19" data-end="633.89">the button example using pre act I find</span> <span data-start="633.89" data-end="635.96">it easier to write the debug the JSX in</span> <span data-start="635.96" data-end="637.88">a simpler environment and then build it</span> <span data-start="637.88" data-end="640.84">into my amp page so let's build this</span> <span data-start="640.84" data-end="644.78">let's start up our server and there's</span> <span data-start="644.78" data-end="646.6">our page with our button it works</span> <span data-start="646.6" data-end="650.48">alright that was a lot if only there was</span> <span data-start="650.48" data-end="654.05">an ant script tutorial out there wait a</span> <span data-start="654.05" data-end="656.51">minute didn't you and I already make one</span> <span data-start="656.51" data-end="659.48">of those yeah you want to take the next</span> <span data-start="659.48" data-end="662.66">slide of course that tutorial is a great</span> <span data-start="662.66" data-end="664.19">introduction to amp script</span> <span data-start="664.19" data-end="668.42">head on over to go ant dev slash learned</span> <span data-start="668.42" data-end="671.87">- script to get started and then keep on</span> <span data-start="671.87" data-end="673.82">going remember that what Kadam is still</span> <span data-start="673.82" data-end="676.16">quite new if you have feature requests</span> <span data-start="676.16" data-end="678.35">or find things that are missing please</span> <span data-start="678.35" data-end="681.2">get involved on github help improve it</span> <span data-start="681.2" data-end="684.26">in conclusion web workers can help you</span> <span data-start="684.26" data-end="686.09">keep JavaScript from slowing down your</span> <span data-start="686.09" data-end="688.58">web pages amp script is a nice way to</span> <span data-start="688.58" data-end="690.74">try this technique out you can find all</span> <span data-start="690.74" data-end="693.07">the code from this talk here on glitch</span> <span data-start="693.07" data-end="695.48">thanks for listening and let's get to</span> <span data-start="695.48" data-end="700.64">work on putting workers to work for you</span> <span data-start="700.64" data-end="707.13">[Music]</span> <span data-start="707.13" data-end="709.33">[Applause]</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
