<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>NNuTV-gjlZQ</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/NNuTV-gjlZQ?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="0.58" data-end="11.389">[Music]</span> <span data-start="11.389" data-end="12.99">true or false</span> <span data-start="12.99" data-end="18.18">indexdb is limited to 25 Meg's false</span> <span data-start="18.18" data-end="21.02">gone are the days of tiny storage quotas</span> <span data-start="21.02" data-end="22.56">true or false</span> <span data-start="22.56" data-end="26.849">local storage should be avoided true</span> <span data-start="26.849" data-end="29.13">it's synchronous and may cause</span> <span data-start="29.13" data-end="31.23">performance issues by blocking the main</span> <span data-start="31.23" data-end="33.78">thread all right here's another one</span> <span data-start="33.78" data-end="35.88">true or false cookies are a great way to</span> <span data-start="35.88" data-end="39.239">store data false they've got their uses</span> <span data-start="39.239" data-end="41.969">but to never be used for storage how</span> <span data-start="41.969" data-end="44.46">about this one app cache is a great way</span> <span data-start="44.46" data-end="48.75">to make your app work offline yeah a</span> <span data-start="48.75" data-end="50.67">trick question absolutely false app</span> <span data-start="50.67" data-end="53.1">cache is awful and it's going away soon</span> <span data-start="53.1" data-end="55.92">thankfully so how should we be storing</span> <span data-start="55.92" data-end="58.23">data and caching our critical app</span> <span data-start="58.23" data-end="60.359">resources on the client how much can we</span> <span data-start="60.359" data-end="62.699">store how does the browser deal with</span> <span data-start="62.699" data-end="65.159">eviction and be sure to stick around to</span> <span data-start="65.159" data-end="67.71">the end and I'll tell you how you can</span> <span data-start="67.71" data-end="70.17">start Chrome with only a tiny storage</span> <span data-start="70.17" data-end="72.81">limit so you can test what happens when</span> <span data-start="72.81" data-end="75.42">you exceed your storage quota I'm Pete</span> </p>
<p><span data-start="75.42" data-end="77.67">LePage let's dive in to storage on the</span> <span data-start="77.67" data-end="81.63">web modern storage makes it possible to</span> <span data-start="81.63" data-end="84">store more than two small chunks of data</span> <span data-start="84" data-end="86.79">on the user's device even in perfect</span> <span data-start="86.79" data-end="89.159">wireless environments caching and other</span> <span data-start="89.159" data-end="91.29">storage techniques can substantially</span> <span data-start="91.29" data-end="94.56">improve performance reliability and most</span> <span data-start="94.56" data-end="97.86">importantly the user experience with the</span> <span data-start="97.86" data-end="100.409">cache storage API you can cast your</span> <span data-start="100.409" data-end="102.96">static app resources like HTML</span> <span data-start="102.96" data-end="105.6">Javascript CSS ensuring that they're</span> <span data-start="105.6" data-end="108.93">always instantly available and with</span> <span data-start="108.93" data-end="111.86">indexdb you can store all kinds of data</span> <span data-start="111.86" data-end="115.02">article content users document settings</span> <span data-start="115.02" data-end="118.71">and more index DB and the cache storage</span> </p>
<p><span data-start="118.71" data-end="120.96">API are supported in every modern</span> <span data-start="120.96" data-end="121.53">browser</span> <span data-start="121.53" data-end="123.93">they're both asynchronous and will not</span> <span data-start="123.93" data-end="126.479">block the main thread they're accessible</span> <span data-start="126.479" data-end="128.61">from the window object web workers and</span> <span data-start="128.61" data-end="131.129">service workers making it easy to use</span> <span data-start="131.129" data-end="133.95">them anywhere in your code there</span> <span data-start="133.95" data-end="136.23">several other storage mechanisms that</span> <span data-start="136.23" data-end="138.51">are available in the browser but they've</span> <span data-start="138.51" data-end="140.75">got limited use and may cause</span> <span data-start="140.75" data-end="143.73">significant performance issues if you're</span> <span data-start="143.73" data-end="145.92">concerned about storing large amounts of</span> <span data-start="145.92" data-end="147.12">data on the client</span> <span data-start="147.12" data-end="149.67">don't be unless you're trying to store</span> <span data-start="149.67" data-end="152.819">several gigs modern browsers typically</span> <span data-start="152.819" data-end="155.16">won't even bat an eye and even then it</span> <span data-start="155.16" data-end="157.44">really comes down to the amount of disk</span> <span data-start="157.44" data-end="159.209">space available on the device</span> <span data-start="159.209" data-end="162.12">of course implementations vary by</span> <span data-start="162.12" data-end="165.239">browsers Firefox allows an origin to</span> <span data-start="165.239" data-end="168.239">store up to two gigs Safari allows an</span> <span data-start="168.239" data-end="170.67">origin to use up to one gig and when</span> <span data-start="170.67" data-end="172.95">that limit is reached Safari is</span> <span data-start="172.95" data-end="174.209">currently the only browser</span> <span data-start="174.209" data-end="176.34">that'll prompt the user to increase that</span> <span data-start="176.34" data-end="179.94">limit and Chrome well look it's a little</span> <span data-start="179.94" data-end="182.4">complex but stick with me here chrome</span> <span data-start="182.4" data-end="184.44">and most other chromium based browsers</span> <span data-start="184.44" data-end="187.56">limit storage to 80% of the total disk</span> <span data-start="187.56" data-end="190.68">space and each origin can only use 75%</span> <span data-start="190.68" data-end="194.01">of that for example if you had a 10 gig</span> <span data-start="194.01" data-end="196.65">hard disk chrome with limited storage to</span> <span data-start="196.65" data-end="199.859">8 gigs then each origin would be limited</span> <span data-start="199.859" data-end="203.28">to 6 gigs essentially each origin will</span> <span data-start="203.28" data-end="206.16">be allowed to use up to 60% of the total</span> <span data-start="206.16" data-end="209.22">disk space it sounds complex but there's</span> <span data-start="209.22" data-end="211.139">an easy way to see what's available in</span> <span data-start="211.139" data-end="214.2">many browsers you can use the Storage</span> </p>
<p><span data-start="214.2" data-end="216.299">Manager API to determine the amount of</span> <span data-start="216.299" data-end="218.459">storage that's available to the origin</span> <span data-start="218.459" data-end="220.68">and how much storage that you're already</span> <span data-start="220.68" data-end="223.139">using it reports the total number of</span> <span data-start="223.139" data-end="225.299">bytes used and makes it possible to</span> <span data-start="225.299" data-end="227.04">calculate the approximate bytes</span> <span data-start="227.04" data-end="230.1">remaining unfortunately the storage</span> <span data-start="230.1" data-end="232.53">manager API isn't implemented in all</span> <span data-start="232.53" data-end="235.019">browsers yet so you must use feature</span> <span data-start="235.019" data-end="238.349">detection before using it but even when</span> <span data-start="238.349" data-end="239.34">it is available</span> <span data-start="239.34" data-end="241.889">you still need to catch over quota</span> <span data-start="241.889" data-end="244.53">errors in some cases and I'm looking at</span> <span data-start="244.53" data-end="246.9">you Chrome it's possible for the</span> <span data-start="246.9" data-end="249.06">available quota to exceed the actual</span> <span data-start="249.06" data-end="252.209">amount of storage available most</span> <span data-start="252.209" data-end="254.97">chromium based browsers factor in the</span> <span data-start="254.97" data-end="257.82">amount of free space when reporting the</span> <span data-start="257.82" data-end="260.19">available quota chrome does not though</span> <span data-start="260.19" data-end="263.669">and it will always report 60% of the</span> <span data-start="263.669" data-end="266.039">actual disk size this helps to reduce</span> <span data-start="266.039" data-end="267.84">the ability to</span> <span data-start="267.84" data-end="270.389">the size of stored cross-origin</span> <span data-start="270.389" data-end="273.419">resources so what should you do when you</span> <span data-start="273.419" data-end="276.54">go over quota most importantly you</span> <span data-start="276.54" data-end="279.03">should always catch and handle right</span> <span data-start="279.03" data-end="281.16">errors whether it's a quota exceeded air</span> <span data-start="281.16" data-end="284.97">or something else then depending on your</span> <span data-start="284.97" data-end="288.27">app design decide how to handle it for</span> <span data-start="288.27" data-end="290.639">example delete content that hasn't been</span> <span data-start="290.639" data-end="293.52">accessed in a long time or remove data</span> <span data-start="293.52" data-end="296.34">based on its size or provide a way for</span> <span data-start="296.34" data-end="299.21">users to choose what they want to delete</span> <span data-start="299.21" data-end="303.12">both indexdb and the CAF api throw a dom</span> <span data-start="303.12" data-end="305.94">error named quota exceeded error when</span> <span data-start="305.94" data-end="308.7">you've exceeded the quota available for</span> <span data-start="308.7" data-end="312.06">indexdb the transactions on abort</span> <span data-start="312.06" data-end="314.58">handler will be called passing an event</span> <span data-start="314.58" data-end="317.639">that event will include a Dom exception</span> <span data-start="317.639" data-end="319.77">in the error property and if you check</span> <span data-start="319.77" data-end="321.96">the name of the error it'll return quota</span> <span data-start="321.96" data-end="325.38">exceeded error for the CAF API rights</span> <span data-start="325.38" data-end="327.96">will reject with a quota exceeded error</span> </p>
<p><span data-start="327.96" data-end="331.02">Dom accept some data stored in the</span> <span data-start="331.02" data-end="332.789">browser can be cleared in a couple of</span> <span data-start="332.789" data-end="336.21">ways it's most commonly initiated by the</span> <span data-start="336.21" data-end="338.7">user choosing to clear data in the</span> <span data-start="338.7" data-end="341.82">browser's site setting panel but it can</span> <span data-start="341.82" data-end="344.13">also happen when faced with storage</span> <span data-start="344.13" data-end="346.919">pressure like load disk space in this</span> <span data-start="346.919" data-end="349.56">case browsers typically automatically</span> <span data-start="349.56" data-end="352.139">delete data from the least recently used</span> <span data-start="352.139" data-end="355.65">origins and continue to delete that</span> <span data-start="355.65" data-end="357.51">until the storage pressure has been</span> <span data-start="357.51" data-end="360.599">relieved if the app hasn't synced data</span> <span data-start="360.599" data-end="363.09">with the server it will cause data loss</span> <span data-start="363.09" data-end="365.4">and means that the app won't have the</span> <span data-start="365.4" data-end="368.639">resources needed to run both of which</span> <span data-start="368.639" data-end="371.06">can lead to a negative user experience</span> <span data-start="371.06" data-end="373.56">thankfully research by the chrome team</span> <span data-start="373.56" data-end="375.389">shows that this doesn't happen very</span> <span data-start="375.389" data-end="378.15">often and it's far more common for users</span> <span data-start="378.15" data-end="381.36">to manually clear storage thus if a user</span> <span data-start="381.36" data-end="383.58">visits your site often the chances are</span> <span data-start="383.58" data-end="386.7">small that data will be deleted let's</span> <span data-start="386.7" data-end="388.68">take a look at a specific example of how</span> <span data-start="388.68" data-end="391.08">automatic eviction might happen in</span> <span data-start="391.08" data-end="394.139">chrome origin a is the least recently</span> <span data-start="394.139" data-end="397.5">visited site origin B is the next least</span> <span data-start="397.5" data-end="399.65">recently visited site and so on</span> <span data-start="399.65" data-end="401.249">origin e and</span> </p>
<p><span data-start="401.249" data-end="402.929">George and Kay are getting close to</span> <span data-start="402.929" data-end="404.729">their quota limits but they haven't</span> <span data-start="404.729" data-end="407.519">reached it yet and the overall usage is</span> <span data-start="407.519" data-end="410.579">less than the total quota so nothing is</span> <span data-start="410.579" data-end="413.549">gonna be evicted origin B has a star</span> <span data-start="413.549" data-end="415.109">next trip because it was granted</span> <span data-start="415.109" data-end="417.389">persistent storage meaning that it can</span> <span data-start="417.389" data-end="420.269">only be deleted by the user check out my</span> <span data-start="420.269" data-end="422.489">article on web dev for more info about</span> <span data-start="422.489" data-end="424.829">persistent storage when you should be</span> <span data-start="424.829" data-end="428.279">using it and how to request it now let's</span> <span data-start="428.279" data-end="431.609">say the user visits Origin n again which</span> <span data-start="431.609" data-end="433.679">happens to be a music playing site the</span> <span data-start="433.679" data-end="435.719">user saves a few more songs for offline</span> <span data-start="435.719" data-end="436.229">listening</span> <span data-start="436.229" data-end="439.139">now each origin is still within its</span> <span data-start="439.139" data-end="441.569">quota limit but Chrome has exceeded the</span> <span data-start="441.569" data-end="444.209">overall limit to get back under the</span> <span data-start="444.209" data-end="446.729">overall limit chrome will start evicting</span> <span data-start="446.729" data-end="448.86">stored data from the least recently used</span> <span data-start="448.86" data-end="451.229">origin first and continue until it's</span> <span data-start="451.229" data-end="454.439">back under the total limit Firefox and</span> <span data-start="454.439" data-end="456.719">other chromium based browsers work in</span> <span data-start="456.719" data-end="459.479">essentially the same way Safari is a</span> <span data-start="459.479" data-end="461.249">little different when it's out of</span> <span data-start="461.249" data-end="463.319">storage it will prevent anything new</span> <span data-start="463.319" data-end="466.589">from being ready but they recently</span> <span data-start="466.589" data-end="468.989">implemented a new 7-day cap on all</span> <span data-start="468.989" data-end="471.709">writable storage including indexdb</span> <span data-start="471.709" data-end="473.849">serviceworker registrations and the</span> <span data-start="473.849" data-end="476.849">cache API this means that after using</span> </p>
<p><span data-start="476.849" data-end="478.979">Safari for seven days and not</span> <span data-start="478.979" data-end="481.169">interacting with the site it will evict</span> <span data-start="481.169" data-end="483.959">all content for that site this eviction</span> <span data-start="483.959" data-end="486.179">policy does not apply to progressive web</span> <span data-start="486.179" data-end="487.739">apps that have been added to the home</span> <span data-start="487.739" data-end="490.979">screen essentially installed pwace check</span> <span data-start="490.979" data-end="492.929">out the WebKit blog linked in the</span> <span data-start="492.929" data-end="495.749">description for complete details modern</span> <span data-start="495.749" data-end="497.519">computers typically have large hard</span> <span data-start="497.519" data-end="499.769">drives which makes it hard to test the</span> <span data-start="499.769" data-end="501.989">over quota failures so here's a little</span> <span data-start="501.989" data-end="505.289">pro tip create a small RAM disk here</span> <span data-start="505.289" data-end="509.399">I've created a 500 mega on my Mac then</span> <span data-start="509.399" data-end="512.189">start Chrome using the user data der</span> <span data-start="512.189" data-end="514.949">flag this tells chrome to store the user</span> <span data-start="514.949" data-end="517.069">profile and user data on the RAM disk</span> </p>
<p><span data-start="517.069" data-end="519.99">Chrome now thinks my disk is only 500</span> <span data-start="519.99" data-end="522.209">Meg's thus is gonna limit my storage</span> <span data-start="522.209" data-end="524.61">quota to only three hundred Meg's which</span> <span data-start="524.61" data-end="527.279">I can quickly fill this makes it much</span> <span data-start="527.279" data-end="529.679">easier to verify that my code behaves</span> <span data-start="529.679" data-end="531.72">properly when it hits those quota</span> <span data-start="531.72" data-end="534.54">exceeded errors chrome dev tools also</span> <span data-start="534.54" data-end="535.08">have</span> <span data-start="535.08" data-end="536.79">helpful features for understanding</span> <span data-start="536.79" data-end="538.5">what's going on with the data that</span> <span data-start="538.5" data-end="540.87">you've stored in the application panel</span> <span data-start="540.87" data-end="543.06">the clear storage panel will show you</span> <span data-start="543.06" data-end="544.92">how much storage you're using for the</span> <span data-start="544.92" data-end="547.35">origin and makes it easy to clear some</span> <span data-start="547.35" data-end="549.36">or all of that data that you've got</span> <span data-start="549.36" data-end="552.42">stored the storage panel lets you see</span> <span data-start="552.42" data-end="554.37">what's in local and session storage as</span> <span data-start="554.37" data-end="556.86">well as what's in index DB including the</span> <span data-start="556.86" data-end="559.56">actual databases and even the individual</span> <span data-start="559.56" data-end="562.62">entries and the CAF storage panel shows</span> <span data-start="562.62" data-end="565.68">you what's stored in cache storage gone</span> <span data-start="565.68" data-end="567.6">are the days of limited storage and</span> <span data-start="567.6" data-end="569.49">prompting the user to store more and</span> <span data-start="569.49" data-end="572.16">more data using the cache storage API</span> <span data-start="572.16" data-end="574.95">and indexdb you can effectively store</span> <span data-start="574.95" data-end="577.29">all the resources that your app needs to</span> <span data-start="577.29" data-end="579.54">run be sure to check out my article</span> <span data-start="579.54" data-end="581.46">storage for the web where I've got</span> <span data-start="581.46" data-end="584.04">additional details and info on some of</span> <span data-start="584.04" data-end="586.62">them not so good storage mechanisms then</span> <span data-start="586.62" data-end="588.51">check out my article on persistent</span> <span data-start="588.51" data-end="590.37">storage to learn how you can protect</span> <span data-start="590.37" data-end="592.98">your data from being blown away even</span> <span data-start="592.98" data-end="594.81">when the device is facing storage</span> <span data-start="594.81" data-end="596.85">pressure see you soon</span> <span data-start="596.85" data-end="608.4">[Music]</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
