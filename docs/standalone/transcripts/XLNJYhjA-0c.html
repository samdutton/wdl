<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>XLNJYhjA-0c</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/XLNJYhjA-0c?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="12" data-end="15.05">Hi, everyone. I'm Eiji and today I'm going to talk about</span> <span data-start="15.3" data-end="16.3">COOP and COEP.</span> <span data-start="18.3" data-end="20.64">COOP and COEP are names of HTTP headers that let</span> <span data-start="21.26" data-end="24.14">your web page opt-in to a special state called</span> <span data-start="24.18" data-end="27.44">'Cross-origin isolated' and gain access to powerful</span> <span data-start="27.44" data-end="29.6">features such as SharedArrayBuffers acrros platforms,</span> <span data-start="29.6" data-end="30.61">performance.measureMemory(), JS</span> <span data-start="33.9" data-end="35.15">Self Profiling API.</span> <span data-start="36.36" data-end="39.2">If you are interested in using a powerful feature from this</span> <span data-start="39.2" data-end="42.2">growing list, you will need to opt-in to COOP and COEP.</span> <span data-start="42.62" data-end="45.29">Also, if you own on a CDN or provide</span> <span data-start="46.12" data-end="48.96">ads, fonts, images, or other resources that get</span> <span data-start="49.08" data-end="51.42">loaded in different origins across the web, you</span> <span data-start="52.13" data-end="53.55">should also watch this video.</span> </p>
<p><span data-start="53.67" data-end="57.22">I will discuss one HTTP header you can add to ensure</span> <span data-start="57.47" data-end="60.51">all your customers can properly load your resources.</span> <span data-start="60.64" data-end="62.64">With that in mind, let's get started.</span> <span data-start="63.01" data-end="65.39">Composability is a super power of the web.</span> <span data-start="66.39" data-end="69.35">You can enhance your website's capabilities by simply</span> <span data-start="69.39" data-end="71.44">adding resources from different sources.</span> <span data-start="71.85" data-end="74.57">Commonly used services include ads,</span> <span data-start="74.82" data-end="77.74">web fonts, images, videos, maps,</span> <span data-start="78.07" data-end="81.2">identity federation, payment solutions, and so</span> <span data-start="81.2" data-end="84.53">on. These services are quite handy and powerful,</span> <span data-start="84.99" data-end="87.62">but their cross-origin nature contributes to increased</span> <span data-start="88" data-end="89.96">risk of information leakage.</span> <span data-start="90.46" data-end="93.84">Malicious parties could take advantage of the situation</span> <span data-start="94.29" data-end="97.34">and exfiltrate information about your users.</span> <span data-start="97.67" data-end="101.05">But browsers do a good job at preventing such scenarios.</span> </p>
<p><span data-start="102.22" data-end="105.05">They keep cross-origin resources separated within a</span> <span data-start="105.1" data-end="107.52">browsing context group when the web page allows that.</span> <span data-start="108.1" data-end="110.94">Browsing context group is a group of tabs, windows, and</span> <span data-start="111.77" data-end="113.77">iframes that share the same context.</span> <span data-start="114.4" data-end="117.28">The same-origin policy is a security feature that restricts</span> <span data-start="117.28" data-end="120.28">how documents and scripts can interact with</span> <span data-start="120.28" data-end="123.16">resources from another origin so that users'</span> <span data-start="123.36" data-end="125.2">information won't accidentally leak.</span> <span data-start="126.08" data-end="129.29">The same-origin policy has been doing a good job keeping</span> <span data-start="129.29" data-end="132.21">the web a safe place.. until Spectre</span> <span data-start="132.83" data-end="134.83">was discovered. Spectre is a vulnerability</span> <span data-start="136" data-end="137.96">found in CPUs that enables malicious web</span> <span data-start="139.13" data-end="142.01">sites to read memory and the contents across the origin</span> <span data-start="142.05" data-end="145.47">boundaries. This vulnerability can be exploited</span> <span data-start="145.68" data-end="148.6">via features that can act as high-precision timers.</span> </p>
<p><span data-start="149.31" data-end="152.23">This leaves cross-origin resources that are shared</span> <span data-start="152.31" data-end="154.77">in a single browsing context group at risk.</span> <span data-start="155.15" data-end="158.19">Even if they are protected by the same-origin policy,</span> <span data-start="158.48" data-end="160.94">Spectre attacks can bypass that border.</span> </p>
<p><span data-start="161.19" data-end="164.2">As a quick response, browser vendors decided</span> <span data-start="164.2" data-end="167.12">to turn off features that could be used to construct</span> <span data-start="167.2" data-end="168.2">high precision timers.</span> <span data-start="168.83" data-end="170.45">For example, SharedArrayBuffer.</span> <span data-start="171.04" data-end="174.37">To mitigate the risk of Spectre and make powerful features</span> <span data-start="174.5" data-end="176.58">available on the web page, its origin needs</span> <span data-start="177.54" data-end="179.3">to be isolated from others.</span> <span data-start="179.42" data-end="182.8">By isolating origins into separate browsing context groups,</span> <span data-start="183.26" data-end="186.22">Spectre and other exploits that grant permission</span> <span data-start="186.34" data-end="189.06">to read arbitrary memory in the same process</span> <span data-start="189.35" data-end="192.35">are no longer able to read cross-origin contents.</span> <span data-start="193.1" data-end="196.31">This, in turn, allows browsers to bring back</span> <span data-start="196.48" data-end="199.32">the powerful features on pages that are properly</span> <span data-start="199.61" data-end="200.61">isolated.</span> <span data-start="200.9" data-end="203.15">Chrome on desktop enabled 'Site Isolation'.</span> </p>
<p><span data-start="204.03" data-end="205.78">This allowed us to turn SharedArrayBuffer</span> <span data-start="206.99" data-end="209.91">back on on desktops. To achieve more robust</span> <span data-start="210.08" data-end="213.37">isolation, the browser needs an explicit</span> <span data-start="213.37" data-end="216.71">signal from the web site that they want to be isolated</span> <span data-start="216.75" data-end="218.33">from cross-origin resources.</span> <span data-start="218.46" data-end="220.75">That is what COOP and COEP are about.</span> <span data-start="221.17" data-end="224.26">To enable cross-origin isolation, you need to do three</span> <span data-start="224.26" data-end="226.72">things. First, set 'Cross-Origin-Opener-Policy:</span> <span data-start="228.34" data-end="230.47">same-origin' for the main document.</span> <span data-start="231.26" data-end="234.48">Second, make sure cross-origin resources use</span> <span data-start="236.48" data-end="237.65">'Cross-Origin-Resource-Policy: cross-origin', or</span> <span data-start="237.9" data-end="239.27">cross-origin resource sharing.</span> </p>
<p><span data-start="239.61" data-end="242.19">Third, set 'Cross-Origin-Embedder-Policy: require-corp'</span> <span data-start="243.82" data-end="244.82">for the main document.</span> <span data-start="245.61" data-end="248.28">Let's walk through each step to see how they work.</span> <span data-start="249.49" data-end="252.2">When 'Cross-Origin-Opener-Policy: same-origin' is set,</span> <span data-start="253.16" data-end="255.96">any cross-origin window opened from the document</span> <span data-start="256.16" data-end="258.92">will have no access to the opener's DOM â€” so</span> <span data-start="258.92" data-end="260.21">'window.opener' will will return null.</span> </p>
<p><span data-start="264.3" data-end="267.38">This is how the document achieves isolation from</span> <span data-start="267.38" data-end="268.38">the cross origin window.</span> <span data-start="268.72" data-end="271.22">To create a cross-origin isolated page, you need to</span> <span data-start="271.76" data-end="274.31">make sure all cross-origin resources embedded in the</span> <span data-start="274.72" data-end="277.6">document explicitly allow it to be loaded.</span> <span data-start="277.77" data-end="279.56">There are two ways to achieve this.</span> <span data-start="279.9" data-end="282.15">By setting 'Cross-Origin-Resource-Policy: cross-origin'</span> <span data-start="283.02" data-end="285.44">or applying cross-origin resource sharing.</span> <span data-start="286.11" data-end="288.95">If you serve resources from a different subdomain that you</span> <span data-start="289.16" data-end="291.91">have control of, you can simply apply the</span> <span data-start="291.91" data-end="293.66">'Cross-Origin-Resource-Policy' header.</span> <span data-start="294.7" data-end="296.79">But what about resources you don't have control of?</span> <span data-start="297.58" data-end="300.12">If the resource already supports cross-origin resource</span> <span data-start="300.12" data-end="302">sharing, you don't need to do much.</span> <span data-start="302.34" data-end="305.42">Just append the 'crossorigin' attribute where it's needed.</span> </p>
<p><span data-start="306.09" data-end="308.8">For resources that don't support it, you should ask the</span> <span data-start="309.05" data-end="311.3">resource provider to enable the</span> <span data-start="311.3" data-end="313.14">'Cross-Origin-Resource-Policy' header.</span> <span data-start="315.56" data-end="317.98">So here's the action item for owners of CDNs</span> <span data-start="318.73" data-end="321.94">or providers of ads, fonts, images</span> <span data-start="322.06" data-end="324.65">or other resources embedded across the web: please be</span> <span data-start="325.02" data-end="327.15">prepared to serve your contents with</span> <span data-start="327.15" data-end="328.86">'Cross-Origin-Resource-Policy: cross-origin'.</span> <span data-start="330.61" data-end="333.83">Without supporting it, your resources will be blocked</span> <span data-start="333.91" data-end="336.49">in the browser and harm your customer's experience at</span> <span data-start="336.91" data-end="337.91">some point.</span> <span data-start="338.41" data-end="340.37">With 'Cross-Origin-Embedder-Policy: require-corp'</span> <span data-start="341.42" data-end="344.5">you can let the web page only load resources that</span> <span data-start="344.59" data-end="346.55">are explicitly marked as sharable unless</span> <span data-start="347.67" data-end="349.67">they are served from the same origin.</span> </p>
<p><span data-start="350.51" data-end="353.14">For example, an image served from</span> <span data-start="353.47" data-end="354.55">cross-origin without a 'Cross-Origin-Resource-Policy'</span> <span data-start="355.76" data-end="357.56">header will be blocked like this.</span> <span data-start="357.72" data-end="360.06">By setting 'Cross-Origin-Resource-Policy: cross-origin'</span> <span data-start="360.23" data-end="362.35">this image can be displayed.</span> <span data-start="362.98" data-end="364.94">Note that if you use report-only mode of</span> <span data-start="365.94" data-end="369.49">Cross Origin Embedder Policy, you can send reports</span> <span data-start="369.69" data-end="372.99">to a specifed URL without actually blocking</span> <span data-start="373.11" data-end="374.12">those resources.</span> <span data-start="374.49" data-end="377.33">I recommend deploying Cross Origin Embedder Policy,</span> <span data-start="377.45" data-end="379.29">starting with the report-only mode.</span> </p>
<p><span data-start="379.95" data-end="382.62">That way you can confirm that cross-origin isolation is</span> <span data-start="383" data-end="385.84">in effect without affecting the end users.</span> <span data-start="386.13" data-end="388.42">Once your page is loaded with COOP and COEP, it</span> <span data-start="389.21" data-end="391.55">should be in the 'cross-origin isolated' state.</span> <span data-start="391.76" data-end="394.68">You can verify 'cross-origin isolated' is in effect</span> <span data-start="395.09" data-end="396.1">by checking</span> <span data-start="398.89" data-end="400.39">'self.crossOriginIsolated' boolean flag in JavaScript. This flag</span> <span data-start="400.43" data-end="403.64">is not available in Chrome yet, but it's coming soon.</span> <span data-start="403.98" data-end="404.98">Let's recap.</span> <span data-start="405.35" data-end="408.36">Start testing with COOP and COEP and opt-in to cross-origin</span> <span data-start="408.82" data-end="409.82">isolation today.</span> <span data-start="410.65" data-end="413.57">You can learn how that works and why they are needed</span> <span data-start="413.7" data-end="415.03">in more details at web.dev/coop-coep and web.dev/why-coop-coep.</span> <span data-start="421.08" data-end="424.37">If you're an owner of a CDN or provider</span> <span data-start="424.5" data-end="427.38">of ads, fonts, images or other resources,</span> <span data-start="428.34" data-end="431.17">please start adopting cross-origin resource policy.</span> </p>
<p><span data-start="432.05" data-end="433.51">You can learn more at</span> <span data-start="435.05" data-end="436.05">resourcepolicy.fyi</span> <span data-start="436.14" data-end="439.26">Additionally, Sam is covering this topic by showing you</span> <span data-start="439.26" data-end="442.39">how DevTools can help you with a variety of issues,</span> <span data-start="442.73" data-end="445.23">which includes new functionality for COOP and COEP.</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
