<section>
<p><span data-start="12.1" data-end="14.77">Hello there. My name's Rowan, and I want to chat to you</span> <span data-start="15.19" data-end="17.65">about cookies. Like most delicious things, cookies</span> <span data-start="18.32" data-end="21.36">are great in moderation, but too many of them or</span> <span data-start="21.4" data-end="23.74">messing up the recipe..That's bad news.</span> <span data-start="24.36" data-end="25.99">OK, so what are we going to chat about?</span> <span data-start="26.32" data-end="28.37">Two bits. First, a good HTTP cookie recipe</span> <span data-start="29.49" data-end="30.87">for all occasions.</span> <span data-start="31.37" data-end="34.16">And second, how to work out when your cookies are going</span> <span data-start="34.16" data-end="35.83">wrong. Debugging, essentially.</span> </p>
<p><span data-start="36.17" data-end="38.46">Because discovering bugs in cookies?</span> <span data-start="38.96" data-end="41.17">Gross. We'll worry about that later, though.</span> <span data-start="41.25" data-end="42.71">First, let's get the recipe right.</span> <span data-start="43.05" data-end="45.43">We're going to start with a base that comes from Mike West,</span> <span data-start="45.93" data-end="48.43">who's really one of the head chefs of the cookie world.</span> <span data-start="49.01" data-end="51.35">This cookie recipe should be your starting point.</span> </p>
<p><span data-start="51.6" data-end="54.31">Everything else we do is going to be a variation on this.</span> <span data-start="54.48" data-end="55.85">So let's take a look at it.</span> <span data-start="56.94" data-end="59.9">It's a lot. I know, but it's mostly static.</span> <span data-start="60.44" data-end="62.98">If you set this up as your default configuration, so</span> <span data-start="63.44" data-end="66.07">it's just added automatically, your code still remains</span> <span data-start="66.45" data-end="69.24">as clean as "set a cookie with this name and this value".</span> <span data-start="70.16" data-end="72.79">And all of these attributes or ingredients come with</span> <span data-start="72.79" data-end="76.12">benefits. So let's step through them first.</span> <span data-start="76.46" data-end="77.75">That "__Host" prefix.</span> <span data-start="78.21" data-end="80.75">Now, that's actually going to set up a few rules for us.</span> <span data-start="81.17" data-end="82.96">It's enforcing these first two attributes: "Secure"</span> <span data-start="84.21" data-end="85.22">and "Path=/".</span> <span data-start="86.38" data-end="88.89">"Secure" means that this cookie will only be set or</span> <span data-start="89.51" data-end="91.68">sent over HTTPS connections.</span> <span data-start="92.39" data-end="95.35">If you haven't fully migrated your site to HTTPS, now</span> <span data-start="95.39" data-end="97.44">is really the time to make that a priority.</span> </p>
<p><span data-start="97.89" data-end="100.48">Browsers are getting more and more functionality behind</span> <span data-start="100.52" data-end="102.77">HTTPS and being more explicit in communicating</span> <span data-start="103.69" data-end="106.82">to users that plain HTTP isn't secure.</span> <span data-start="107.57" data-end="109.66">Now "Path=/" is interesting.</span> <span data-start="109.95" data-end="112.2">And we need to look at that along with another attribute</span> <span data-start="112.28" data-end="113.62">that "__Host" is enforcing.</span> </p>
<p><span data-start="114.16" data-end="117.21">But in this case, enforcing that it is not included.</span> <span data-start="117.54" data-end="118.54">And that's "Domain".</span> <span data-start="119.04" data-end="121.67">No "Domain" means the cookie uses the current document</span> <span data-start="122.09" data-end="124.63">origin and does not include subdomains.</span> <span data-start="125.01" data-end="128.01">And "Path=/" means that it's sent for all</span> <span data-start="128.05" data-end="129.59">requests to the origin.</span> <span data-start="130.09" data-end="132.26">So if I set a __Host cookie for example.com,</span> <span data-start="133.31" data-end="135.6">it will go on every request to example.com, but</span> <span data-start="136.39" data-end="137.39">not to images.example.com.</span> <span data-start="139.27" data-end="140.4">There you go, that was three-in-one.</span> <span data-start="141.06" data-end="143.69">"__Host" prefix gives you "Secure", top-level "Path" and</span> <span data-start="144.48" data-end="145.48">no "Domain".</span> </p>
<p><span data-start="145.94" data-end="148.03">Next up is the "HTTPonly" attribute.</span> <span data-start="148.7" data-end="151.16">This means that the cookie will only be sent in request</span> <span data-start="151.16" data-end="153.49">headers and is not available to JavaScript via</span> <span data-start="153.7" data-end="154.7">document.cookie.</span> <span data-start="155.33" data-end="158.46">To clarify, you can trigger requests from JavaScript</span> <span data-start="158.54" data-end="159.79">like fetch or XmlHttpRequest.</span> <span data-start="161.71" data-end="164.54">And if you've specified including credentials, cookies,</span> <span data-start="164.63" data-end="167.17">including HttpOnly cookies will be sent.</span> </p>
<p><span data-start="167.8" data-end="170.18">They're just not visible to those client-side scripts in</span> <span data-start="170.18" data-end="173.18">any way. So in the event that any of those scripts on</span> <span data-start="173.18" data-end="176.14">your site have been compromised or malicious, you've at</span> <span data-start="176.14" data-end="178.81">least limited their access to potentially sensitive cookie</span> <span data-start="178.81" data-end="179.81">data.</span> <span data-start="180.1" data-end="181.77">Finally, a personal favorite.</span> <span data-start="182.15" data-end="183.15">It's SameSite.</span> <span data-start="183.44" data-end="184.48">Specifically, "SameSite=Lax".</span> <span data-start="185.94" data-end="189.15">And what "SameSite=Lax" does is restrict the cookie to only</span> <span data-start="189.15" data-end="191.66">be sent on requests that match the current browsing</span> <span data-start="191.86" data-end="194.87">context. In other words, the top level site</span> <span data-start="194.91" data-end="197.62">the user is currently visiting and is right there in that</span> <span data-start="197.62" data-end="198.62">location bar.</span> </p>
<p><span data-start="199.37" data-end="202.33">Putting that all together, we have a nicely contained first</span> <span data-start="202.33" data-end="203.33">party cookie.</span> <span data-start="203.79" data-end="206.63">This is an ideal cookie for controlling your user session,</span> <span data-start="207" data-end="208.59">set by your server-side framework.</span> <span data-start="209.21" data-end="210.22">And let's talk about why.</span> <span data-start="210.67" data-end="212.8">What this gives you some pretty reasonable protection</span> <span data-start="212.8" data-end="214.68">against cross-site request forgery.</span> <span data-start="215.14" data-end="218.14">The attack works like this, let's say you have a blog where</span> <span data-start="218.14" data-end="220.31">users need to be signed in to post content.</span> <span data-start="220.68" data-end="223.6">And that content submission is just a form submission or an</span> <span data-start="223.6" data-end="224.6">API call.</span> </p>
<p><span data-start="225.02" data-end="228.23">If one of those signed in users visits a malicious site,</span> <span data-start="228.65" data-end="231.65">it can trigger a request to that content posting</span> <span data-start="231.65" data-end="234.74">endpoint with some kind of spammy or abusive content.</span> <span data-start="235.49" data-end="238.33">If the cookies aren't protected, the browser may well send</span> <span data-start="238.66" data-end="241.62">them. And when the blog server receives that request,</span> <span data-start="241.75" data-end="244.29">it's going to look like it came from the signed in user.</span> <span data-start="244.75" data-end="246.79">And it's going to post that content with their name</span> <span data-start="246.79" data-end="249.84">attached, but not with our cookie recipe they can't.</span> <span data-start="250.63" data-end="253.84">"SameSite=Lax" is what's protecting us against this attack.</span> <span data-start="254.43" data-end="257.43">The malicious site can make the request, but because the</span> <span data-start="257.43" data-end="260.43">user isn't actually on the blogging site, the site</span> <span data-start="260.43" data-end="262.98">is no match and therefore no cookie.</span> <span data-start="264.06" data-end="265.15">There are some other benefits too.</span> <span data-start="265.9" data-end="268.19">The "Secure" attribute means that we're going over HTTPS,</span> <span data-start="269.19" data-end="272.19">so other people lurking on the same network can't steal</span> <span data-start="272.19" data-end="275.16">our cookie. Look up Firesheep if you want to see</span> <span data-start="275.16" data-end="278.03">how someone created an extension to demo just how easy this</span> <span data-start="278.16" data-end="280.91">kind of session hijacking over HTTP was.</span> </p>
<p><span data-start="281.54" data-end="282.54">Next up, HttpOnly.</span> <span data-start="283.58" data-end="286.21">Like we said, that means the cookie can't be stolen by</span> <span data-start="286.37" data-end="289.25">malicious client side JavaScript, like a third party</span> <span data-start="289.25" data-end="291.8">dependency getting hacked and then included on your site.</span> <span data-start="292.76" data-end="294.76">Now let's talk about tweaking this recipe for your own</span> <span data-start="294.8" data-end="297.72">taste. If the "__Host" prefix is too restrictive,</span> <span data-start="297.8" data-end="300.22">like maybe you have a new site and you've set it up with</span> <span data-start="300.22" data-end="303.1">subdomains for each topic like "finance." and "politics.",</span> <span data-start="304.1" data-end="306.52">but you still want one session across all of those.</span> <span data-start="306.94" data-end="309.94">For that, you could use the "__Secure" prefix instead</span> <span data-start="310.11" data-end="311.36">and specify "Domain".</span> <span data-start="312.11" data-end="315.32">So far, these examples don't have any kind of expiry date</span> <span data-start="315.32" data-end="318.07">set on them. That means they expire when the browser</span> <span data-start="318.07" data-end="321.16">session ends. Which sounds short, but in</span> <span data-start="321.16" data-end="324.2">reality, a lot of people leave their browser open for a</span> <span data-start="324.2" data-end="327.5">long time or I have a session restoring feature</span> <span data-start="327.54" data-end="329.71">that also brings back all those cookies.</span> </p>
<p><span data-start="330.42" data-end="332.96">Now, there isn't a default right answer here.</span> <span data-start="333.09" data-end="334.67">It's down to your use case.</span> <span data-start="335.13" data-end="338.22">But what I would say is if it's something short term,</span> <span data-start="338.34" data-end="341.47">like a token for a form submission, then use "Max-Age".</span> <span data-start="342.31" data-end="344.72">Since you just specify the number of seconds until it</span> <span data-start="344.72" data-end="346.27">expires. Nice and simple.</span> <span data-start="346.98" data-end="350.02">If it's something more permanent, like a theme preference,</span> <span data-start="350.44" data-end="353.44">then use "Expires" and set it maybe a year</span> <span data-start="353.44" data-end="354.57">in the future.</span> <span data-start="355.03" data-end="357.2">I wouldn't use it for anything short term because it's a</span> <span data-start="357.2" data-end="359.66">date format. So you have to think about time zones, clock</span> <span data-start="360.28" data-end="361.87">changes, incorrect clocks.</span> <span data-start="361.95" data-end="364.08">It's it's a nightmare. I'm not even gonna show you that</span> <span data-start="364.08" data-end="367.04">one. Remember, you can always reset that</span> <span data-start="367.04" data-end="369.17">expiry date on future requests, but then if</span> <span data-start="370.08" data-end="372.71">the user doesn't visit your site for ages, you can also</span> <span data-start="372.71" data-end="374.3">ensure the browser cleans up for you.</span> </p>
<p><span data-start="374.71" data-end="376.01">And that just seems polite.</span> <span data-start="376.26" data-end="377.47">No one wants stale cookies.</span> <span data-start="378.26" data-end="380.51">We can also use the "SameSite" attribute to lock things</span> <span data-start="380.51" data-end="382.93">down a bit more. But it's really for quite specific</span> <span data-start="382.93" data-end="383.93">situations.</span> <span data-start="384.18" data-end="387.18">We talked about "SameSite=Lax", which allows cookies to be</span> <span data-start="387.18" data-end="389.1">sent on top-level navigations.</span> <span data-start="389.23" data-end="391.9">For example, I want my session to be sent when I first</span> <span data-start="392.19" data-end="393.9">visit the site because I want to see my signed-in</span> <span data-start="394.73" data-end="397.69">experience. "SameSite" can also be set to "Strict".</span> </p>
<p><span data-start="397.94" data-end="400.57">Which means I really have to be on the site already</span> <span data-start="400.95" data-end="402.16">or the cookie won't be sent.</span> <span data-start="403.24" data-end="405.41">This is useful for protecting form submission.</span> <span data-start="405.66" data-end="407.25">So that blog posting example?</span> <span data-start="407.79" data-end="410.17">If you set up a "SameSite=Strict"" cookie.</span> <span data-start="410.33" data-end="411.79">Pretty much the same as your session.</span> <span data-start="412.25" data-end="415.21">But you treat it like a token for "write" permission</span> <span data-start="415.63" data-end="418.38">and validate that it's included on that form submission.</span> </p>
<p><span data-start="418.63" data-end="420.93">Then you can be pretty sure it came from the user</span> <span data-start="420.93" data-end="423.3">submitting the form actually on your site.</span> <span data-start="424.14" data-end="426.26">Sometimes you do need that cross-site data, though.</span> <span data-start="426.89" data-end="429.39">Now, while the long-term goal is to stop supporting</span> <span data-start="429.43" data-end="431.81">cross-site cookies and bring in better mechanisms for</span> <span data-start="431.85" data-end="433.23">enabling that functionality.</span> <span data-start="433.56" data-end="436.11">We can still do some interim work to clean up those cookies</span> <span data-start="436.11" data-end="438.32">right now. The really important thing is that</span> <span data-start="439.07" data-end="441.99">you make the intent to send that cross-site data</span> <span data-start="442.2" data-end="443.2">totally explicit.</span> <span data-start="443.87" data-end="447.08">For that, we can turn the "SameSite" dial the other way</span> <span data-start="447.2" data-end="448.16">with "SameSite=None".</span> <span data-start="449.29" data-end="451.08">That tells the browser that there are no "SameSite"</span> <span data-start="451.46" data-end="454.58">restrictions and it can send the cookie whenever.</span> </p>
<p><span data-start="455.25" data-end="457.3">It does require "Secure" as well, though.</span> <span data-start="457.67" data-end="460.59">No restrictions on "Site" doesn't mean no restrictions</span> <span data-start="460.63" data-end="463.97">at all. Now, even if you don't like the default recipe,</span> <span data-start="464.09" data-end="467.1">I strongly recommend you move to setting an explicit</span> <span data-start="467.1" data-end="468.52">"SameSite" value on your cookies.</span> <span data-start="468.93" data-end="470.93">Chrome is moving to treat cookies as "SameSite=Lax"</span> <span data-start="471.94" data-end="474.94">by default for Chrome version 80 and up</span> <span data-start="475.31" data-end="477.57">with the release of Chrome 84 Stable.</span> <span data-start="478.15" data-end="480.69">That's around July 14th, two weeks from this initial</span> <span data-start="481.15" data-end="484.36">broadcast date. If you're watching this on the Premiere or</span> <span data-start="484.53" data-end="486.91">even sooner, if you're already watching this in the future.</span> <span data-start="487.62" data-end="490.66">or in the past. Anyway, the important thing is</span> <span data-start="490.79" data-end="493.58">cookies without a "SameSite" attribute will be treated as</span> <span data-start="493.75" data-end="494.75">"SameSite=Lax".</span> </p>
<p><span data-start="495.38" data-end="497.5">In other words, first party by default.</span> <span data-start="498.17" data-end="500.8">If you need cross-site with third-party cookies, they</span> <span data-start="501.26" data-end="504.38">must be set with "SameSite=none" and "Secure".</span> <span data-start="505.22" data-end="508.22">OK, so that's all simple enough for me to say, but</span> <span data-start="508.35" data-end="511.27">I know a lot of you are maintaining legacy or complex sites</span> <span data-start="511.39" data-end="514.64">where, to be honest, you don't always know</span> <span data-start="514.64" data-end="516.65">how or why those cookies are being set.</span> </p>
<p><span data-start="517.15" data-end="519.77">Told you were going to talk about debugging, so let's do</span> <span data-start="519.77" data-end="520.78">it.</span> <span data-start="522.19" data-end="524.86">First. Let's get our environment setup, starting with the</span> <span data-start="524.95" data-end="528.07">browser. Cookies are persistent, meaning that you've</span> <span data-start="528.07" data-end="530.08">probably got a lot hanging around in your browser.</span> <span data-start="530.41" data-end="533.29">On top of that, browser settings and extensions</span> <span data-start="533.37" data-end="534.71">can also affect their behavior.</span> </p>
<p><span data-start="535.5" data-end="538.33">Because of that, I strongly recommend testing with a clean</span> <span data-start="538.71" data-end="541.84">slate. That means either setting up a new profile</span> <span data-start="541.84" data-end="544.42">using a separate Chrome channel like Beta or Canary,</span> <span data-start="545.01" data-end="548.18">or use incognito mode across all of those, though.</span> <span data-start="548.55" data-end="551.06">Make sure that you don't have any extensions installed.</span> <span data-start="551.14" data-end="553.52">And check your user settings to ensure you're not blocking</span> <span data-start="553.52" data-end="556.77">third-party cookies or just blocking cookies in general.</span> <span data-start="557.35" data-end="559.81">Now, we can make sure the browser is enforcing the new</span> <span data-start="559.81" data-end="563.11">behavior. I'm going to pop</span> <span data-start="563.11" data-end="564.86">in chrome://flags</span> <span data-start="566.95" data-end="568.49">here and what I'm going to do is</span> <span data-start="570.12" data-end="572.29">search for cookies.</span> <span data-start="572.91" data-end="575">Now, the two that I want to ensure are enabled are</span> <span data-start="576.58" data-end="578.46">"SameSite by default cookies" here and</span> <span data-start="579.71" data-end="582.5">"cookies without SameSite must be secure" here.</span> </p>
<p><span data-start="583.76" data-end="586.34">There are a couple of other messages in here, a couple of</span> <span data-start="586.34" data-end="588.84">other flags that you can set. So if you look through, you</span> <span data-start="588.84" data-end="592.56">can also see this one "enable experimental</span> <span data-start="592.56" data-end="593.56">cookie features".</span> </p>
<p><span data-start="593.93" data-end="597.31">Now, what this will do is turn on all of the upcoming</span> <span data-start="597.31" data-end="600.27">changes. So this is actually great for general</span> <span data-start="600.27" data-end="602.4">testing. If you just want to check that, you know, your</span> <span data-start="602.4" data-end="604.36">site can behave well in the future.</span> <span data-start="604.78" data-end="607.9">But when you are trying to isolate individual bugs,</span> <span data-start="608.2" data-end="611.12">you can use the individual flags to toggle that behavior</span> <span data-start="611.16" data-end="613.7">on and off. Now, when you've changed a flag, you are</span> <span data-start="614.2" data-end="617.37">going to have to restart your web browser here</span> <span data-start="617.58" data-end="620.17">so that those flags take effect.</span> </p>
<p><span data-start="621.04" data-end="623.38">Now, I already have restarted and I have a test</span> <span data-start="624.3" data-end="625.96">site set up on samesite-sandbox.glitch.me.</span> <span data-start="628.68" data-end="631.68">And if you've got all the flags enabled when</span> <span data-start="631.68" data-end="634.85">you go there, you should see all this nice, soothing green.</span> <span data-start="635.35" data-end="637.6">Any red or orange Xs in there.</span> <span data-start="637.89" data-end="640.77">Go back, check your cookie settings, check your flags.</span> <span data-start="641.44" data-end="643.86">With all of that configured, I'm going to walk you through</span> <span data-start="643.86" data-end="646.69">this excellent debugging guide, which comes from Lily Chen,</span> <span data-start="646.69" data-end="648.15">one of the engineers working on SameSite.</span> <span data-start="648.82" data-end="651.36">So don't worry, if you don't catch everything I do in this</span> <span data-start="651.36" data-end="654.37">video, it's all written down in there and there's a link</span> <span data-start="654.49" data-end="655.83">in the info.</span> </p>
<p><span data-start="656.2" data-end="658.91">And going to keep using the SameSite sandbox for testing.</span> <span data-start="659" data-end="660.42">The code is all on Glitch.</span> <span data-start="660.46" data-end="662.75">If you expand the info there you can find a link.</span> <span data-start="662.83" data-end="665.88">Feel free to remix this if you want to run your own version</span> <span data-start="665.88" data-end="668.63">or try some different combinations of cookies and so on.</span> <span data-start="669.51" data-end="671.68">Let's open up DevTools and start poking around.</span> <span data-start="672.26" data-end="674.72">I'm going to start on the Console tab.</span> <span data-start="675.47" data-end="678.52">And you'll probably see some warnings, but we're</span> <span data-start="678.52" data-end="679.89">going to be cleaning those up.</span> <span data-start="680.23" data-end="682.77">So what you actually want to look for, if you're on a</span> <span data-start="682.77" data-end="685.19">recent enough version of Chrome, like 84 and onwards,</span> <span data-start="685.77" data-end="687.78">is the Issues tab here.</span> <span data-start="688.03" data-end="690.82">So the warnings are going to show you the same information</span> <span data-start="690.86" data-end="693.99">that Issues tab does, but the Issues tab is much</span> <span data-start="693.99" data-end="695.53">clearer, much more actionable.</span> </p>
<p><span data-start="696.16" data-end="699.29">Sam's got a video where he goes through the full tour on</span> <span data-start="699.29" data-end="701.33">that. So I'm going to go through this pretty quick.</span> <span data-start="701.71" data-end="703.92">Let's take a look. It's tap on "go to issues".</span> <span data-start="705" data-end="707.8">The first thing it tells us is that we want to reload the</span> <span data-start="707.84" data-end="709.55">page to get that full capture.</span> <span data-start="709.59" data-end="712.3">So let's take that advice and reload.</span> <span data-start="713.18" data-end="715.47">Now, you can see I've got some issues that have come up.</span> </p>
<p><span data-start="715.85" data-end="716.85">Let's take a look.</span> <span data-start="717.35" data-end="720.6">Now, the first one we've got is "mark cross-site cookies</span> <span data-start="720.68" data-end="722.02">as secure".</span> <span data-start="722.39" data-end="726.11">Let's expand that and see what's going on inside.</span> <span data-start="726.48" data-end="729.28">So you can see that this one is telling me that I've got a</span> <span data-start="729.28" data-end="732.4">cookie that's marked with "SameSite=none", but</span> <span data-start="732.61" data-end="734.36">it's missing the "Secure" attribute.</span> <span data-start="735.03" data-end="737.62">If I scroll down a bit more, I can also see I've got some</span> <span data-start="737.62" data-end="740.2">affected resources so I can expand that out.</span> </p>
<p><span data-start="740.62" data-end="743.29">And that is going to show me exactly the cookie that's</span> <span data-start="743.46" data-end="746.58">affected. If I click on that cookie here</span> <span data-start="747.09" data-end="749.55">and see it takes me to the Network tab up here.</span> <span data-start="750" data-end="752.8">I can expand that so we can see a bit of what's going on.</span> <span data-start="753.76" data-end="756.84">And it's using this filter entry to basically</span> <span data-start="756.84" data-end="758.22">filter that down, too.</span> <span data-start="758.89" data-end="761.97">So you can see it's filtered it specifically to the</span> <span data-start="761.97" data-end="764.85">cookie name that has the problem, so it is showing me all</span> <span data-start="764.85" data-end="767.9">the requests that include that specific cookie.</span> <span data-start="769.61" data-end="771.86">We'll come back to the network tab in a minute.</span> <span data-start="771.86" data-end="773.36">So hold on to that.</span> <span data-start="773.78" data-end="775.24">And we'll take a look at the other issue first.</span> <span data-start="776.41" data-end="779.28">So back in here, let's scroll down again</span> <span data-start="779.78" data-end="781.2">and expand that.</span> </p>
<p><span data-start="781.54" data-end="784.71">The second issue is telling me</span> <span data-start="784.75" data-end="788.25">that I have some cookies that don't specify</span> <span data-start="788.29" data-end="789.75">a "SameSite" attribute at all.</span> <span data-start="789.79" data-end="792.42">So the browser just doesn't know what to do with that</span> <span data-start="792.42" data-end="795.47">cookie. Maybe we're OK with it being first party,</span> <span data-start="795.51" data-end="797.22">but we haven't told anyone.</span> <span data-start="797.22" data-end="799.97">So let's take a look at the cookies that are affected in</span> <span data-start="800.22" data-end="802.31">there. So I'm going to expand this again.</span> <span data-start="802.68" data-end="806.1">And you can see I've got two cookies</span> <span data-start="806.19" data-end="807.19">affected.</span> <span data-start="808.1" data-end="810.02">Right well now, we know where the problems are.</span> <span data-start="810.27" data-end="812.86">Let's go over to the Network tab to take a look in detail.</span> <span data-start="813.73" data-end="816.11">This is a pretty simple site, so there aren't that many</span> <span data-start="816.11" data-end="819.2">requests. In reality, you've probably got far more to wade</span> <span data-start="819.2" data-end="821.41">through. So let's look at some ways that you can filter</span> <span data-start="821.41" data-end="822.41">that down.</span> </p>
<p><span data-start="822.74" data-end="824.87">What I'm gonna do is right-click in here and</span> <span data-start="825.75" data-end="829.29">go to header options where I can enable cookies</span> <span data-start="829.63" data-end="832.46">and also set cookies.</span> <span data-start="833.55" data-end="836.76">So this is going to show me each of the requests.</span> <span data-start="836.92" data-end="839.09">And how many cookies they are sending.</span> <span data-start="839.55" data-end="842.43">And how many cookies are being set by the set cookie header</span> <span data-start="842.56" data-end="844.02">in the response.</span> <span data-start="845.31" data-end="847.56">The other part of the puzzle then is this "Has</span> <span data-start="848.35" data-end="850.23">blocked cookies" toggle up here.</span> </p>
<p><span data-start="850.52" data-end="853.73">Now, if I turn that on, you can see one</span> <span data-start="853.73" data-end="855.69">of our requests is disappearing.</span> <span data-start="856.11" data-end="859.03">So when I have this on, it's filtering out all the requests</span> <span data-start="859.41" data-end="861.57">that are not being altered in any way.</span> <span data-start="861.91" data-end="864.99">So we've got a pretty good idea that it's these two that</span> <span data-start="864.99" data-end="866.54">are responsible for the issues.</span> <span data-start="867.54" data-end="869.92">Back on the table, let's look at the request of the page</span> <span data-start="869.92" data-end="873">first. So tap on there and</span> <span data-start="873.04" data-end="875.25">on the cookies tab over here.</span> <span data-start="875.71" data-end="878.09">I can see that I have one of my response cookies</span> <span data-start="878.67" data-end="881.01">highlighted. So I'm gonna hover over that.</span> <span data-start="881.55" data-end="884.76">And that info bar is telling us that</span> <span data-start="884.85" data-end="887.64">this is the cookie that's got the "SameSite=none", but is</span> <span data-start="887.77" data-end="889.19">missing the "Secure" flag.</span> </p>
<p><span data-start="889.64" data-end="891.15">So I've got the name.</span> <span data-start="891.19" data-end="893.69">I've got the value. Hopefully that's enough for you to</span> <span data-start="893.69" data-end="896.32">track it down the back end and get that secure flag</span> <span data-start="896.69" data-end="898.65">set. Okay, but we had another issue that</span> <span data-start="899.74" data-end="901.07">was listed as well.</span> <span data-start="901.11" data-end="903.82">So let's take a look at the second request.</span> </p>
<p><span data-start="903.95" data-end="904.95">That's cookies.json.</span> <span data-start="906.16" data-end="907.87">Now, this one looks fairly quiet.</span> <span data-start="907.95" data-end="911.25">So the thing we want to do here is enable this show</span> <span data-start="911.25" data-end="913">filtered out request cookies.</span> <span data-start="913.92" data-end="916.55">Suddenly, there's a lot more going on here.</span> <span data-start="917.13" data-end="920.09">Now, what this is showing us is all the cookies that</span> <span data-start="920.13" data-end="923.05">could have been included on that request but were</span> <span data-start="923.09" data-end="924.64">restricted for some reason.</span> </p>
<p><span data-start="925.01" data-end="927.27">Now, some of them are for the right reasons.</span> <span data-start="927.31" data-end="930.1">So you can see here we've got a cookie that has "SameSite=</span> <span data-start="930.56" data-end="933.6">Strict" and that's not included in the cross-site request.</span> <span data-start="933.98" data-end="935.11">Got one that says "SameSite=Lax".</span> <span data-start="936.19" data-end="938.73">Same deal. We don't want it on the cross-site request.</span> <span data-start="939.4" data-end="941.9">But then we've got these two where they've got a blank</span> <span data-start="942.45" data-end="943.41">"SameSite" value.</span> <span data-start="943.82" data-end="946.83">Now, that means that the browser is treating them as</span> <span data-start="947.08" data-end="948.95">"SameSite=Lax" and therefore restricting them.</span> </p>
<p><span data-start="949.33" data-end="952.67">This might be because you didn't specify a SameSite value,</span> <span data-start="952.92" data-end="955.88">but it might also be because you've got an invalid value in</span> <span data-start="955.88" data-end="958.71">there. So get into your code and look for those SameSite</span> <span data-start="958.88" data-end="961.17">attributes. And check the spelling to make sure there are</span> <span data-start="961.17" data-end="962.47">no typos in there as well.</span> <span data-start="963.59" data-end="966.05">Now, DevTools is great for this kind of interactive</span> <span data-start="966.05" data-end="968.47">exploration, but we can also explore the data for</span> <span data-start="969.06" data-end="970.56">a whole series of requests.</span> <span data-start="971.1" data-end="973.23">This is helpful if you need to grab the data for a</span> <span data-start="973.23" data-end="975.48">particular situation, like maybe it's one user</span> <span data-start="976.48" data-end="978.69">with a particular account type who has been able to</span> <span data-start="978.69" data-end="981.07">reproduce this problem and you can't necessarily</span> <span data-start="981.65" data-end="983.99">sit down with them at their machine for a good debugging</span> <span data-start="983.99" data-end="984.99">session together.</span> </p>
<p><span data-start="985.78" data-end="987.95">For this, we're going to capture a network log.</span> <span data-start="988.24" data-end="989.87">So open up a new tab.</span> <span data-start="990.04" data-end="991.04">Go to chrome://net-export.</span> <span data-start="994.67" data-end="997.54">If you've been doing a whole bunch of these, then you may</span> <span data-start="997.54" data-end="999.59">need to click "start over" on that.</span> <span data-start="1000.63" data-end="1003.42">And what we want to make sure of, in the options, is that</span> <span data-start="1003.51" data-end="1006.22">we say "include cookies and credentials".</span> </p>
<p><span data-start="1006.43" data-end="1007.97">Because that's what we're trying to test.</span> <span data-start="1008.39" data-end="1010.22">But just be mindful that including all</span> <span data-start="1011.39" data-end="1014.31">of this means that you may be logging some sensitive user</span> <span data-start="1014.31" data-end="1017.06">data. So treat it in exactly the same way that you would</span> <span data-start="1017.44" data-end="1020.27">with any other. Make sure that you have the consent to log</span> <span data-start="1020.27" data-end="1022.78">it. Make sure that you're controlling access to that log</span> <span data-start="1023.15" data-end="1025.24">and delete it when you're done debugging the issue.</span> <span data-start="1025.99" data-end="1028.07">OK, press "Start Logging to Disk".</span> <span data-start="1029.12" data-end="1032.58">And I am just going to save that in my downloads directory.</span> <span data-start="1033.41" data-end="1036.33">OK. Now do not close this tab because this is what's doing</span> <span data-start="1036.33" data-end="1038.96">the recording. But we are going to switch back over to our</span> <span data-start="1038.96" data-end="1042">test site, and I am just going to reload</span> <span data-start="1042" data-end="1044.05">the page to capture that behavior.</span> <span data-start="1044.72" data-end="1047.8">Now, in reality, what you want to do is capture the</span> <span data-start="1047.8" data-end="1050.43">entire user journey that you're trying to debug.</span> </p>
<p><span data-start="1051.06" data-end="1053.81">At a minimum, it's got to be the section that is causing</span> <span data-start="1053.81" data-end="1056.27">the problem. But often you should probably try and start</span> <span data-start="1056.6" data-end="1059.56">maybe from like user sign in or wherever the cookies are</span> <span data-start="1059.56" data-end="1062.07">being set because you probably want to capture that</span> <span data-start="1062.44" data-end="1063.53">interaction as well.</span> <span data-start="1064.28" data-end="1067.11">OK. Once you're done, we're going to switch back over to</span> <span data-start="1067.11" data-end="1069.28">our Network tab and we're going to say "stop</span> <span data-start="1070.03" data-end="1071.03">logging".</span> <span data-start="1071.37" data-end="1074.33">Now, you can say like "show file" here</span> <span data-start="1074.66" data-end="1077.12">and you can see that it's just a JSON file in this</span> <span data-start="1077.33" data-end="1078.79">directory. You can take a look at it.</span> <span data-start="1078.96" data-end="1081.25">It is pretty big and it's pretty verbose.</span> </p>
<p><span data-start="1081.34" data-end="1084.05">So what we want to do is make use of the NetLog</span> <span data-start="1084.51" data-end="1087.51">viewer tool which is linked from this page.</span> <span data-start="1087.93" data-end="1091.26">So you go there and I'm going to go to the hosted</span> <span data-start="1091.26" data-end="1092.26">version here.</span> <span data-start="1092.97" data-end="1096.02">Now I choose my file, which is</span> <span data-start="1096.06" data-end="1097.31">just there, chrome-export-log.</span> </p>
<p><span data-start="1099.9" data-end="1102.36">And there we go. You can see that I've got a whole bunch of</span> <span data-start="1102.36" data-end="1105.19">information about the logging that I've just done.</span> <span data-start="1105.53" data-end="1108.7">You can see my Chrome version, you can see the OS info.</span> <span data-start="1109.41" data-end="1111.91">What you can also see is if you dive</span> <span data-start="1112.37" data-end="1115.37">into this where you've got features here,</span> <span data-start="1115.79" data-end="1118.66">you can see all the flags that I've got enabled.</span> <span data-start="1118.71" data-end="1119.92">I've been playing with quite a few of them.</span> <span data-start="1120.75" data-end="1123.92">But there's also "cookies without SameSite must be secure"</span> <span data-start="1124.04" data-end="1125.05">embedded in there.</span> <span data-start="1125.5" data-end="1128.63">The stuff we're looking for, though, related to the cookies</span> <span data-start="1128.72" data-end="1131.01">is over in the Events section.</span> <span data-start="1131.18" data-end="1132.39">So I'm going to go over here.</span> </p>
<p><span data-start="1132.89" data-end="1135.97">And as you can see, I've got 200 events to deal</span> <span data-start="1135.97" data-end="1137.73">with. So this is pretty verbose.</span> <span data-start="1137.77" data-end="1139.81">This is all of the requests that Chrome is</span> <span data-start="1140.85" data-end="1143.44">sending, kind of all of the network related events,</span> <span data-start="1143.77" data-end="1146.78">including extensions, including other tabs.</span> <span data-start="1147.11" data-end="1148.99">So let's filter this down to something</span> <span data-start="1150.4" data-end="1153.37">a bit more useful. I want to type and it is</span> <span data-start="1153.49" data-end="1154.45">"URL_REQUEST".</span> </p>
<p><span data-start="1157.29" data-end="1160">Make sure there's no space after that column</span> <span data-start="1160.62" data-end="1162.58">and there you go. That's a bit more manageable.</span> <span data-start="1162.88" data-end="1165.34">You can see that there's a bunch of other things going on</span> <span data-start="1165.34" data-end="1168.55">in there, but I can see my SameSite sandbox</span> <span data-start="1168.63" data-end="1171.3">requests. These are the ones that I'm interested in.</span> <span data-start="1172.8" data-end="1175.35">Let's find that cookies.json one.</span> </p>
<p><span data-start="1175.97" data-end="1179.23">And inside of here, it's this string</span> <span data-start="1179.23" data-end="1180.31">that I'm interested in, "COOKIE_INCLUSION_STATUS".</span> <span data-start="1182.31" data-end="1185.06">Now, what that's telling me is basically why a cookie was</span> <span data-start="1185.11" data-end="1187.02">or wasn't included in the request.</span> <span data-start="1187.65" data-end="1190.78">And if I look through there, you can see each</span> <span data-start="1190.78" data-end="1192.82">of the different ones.</span> <span data-start="1193.28" data-end="1194.66">So I've got.</span> <span data-start="1194.78" data-end="1196.03">Let's see what we got in here.</span> <span data-start="1196.08" data-end="1199.7">"COOKIE_INCLUSION_STATUS" is</span> <span data-start="1199.83" data-end="1201.04">"exclude" because that's "SameSite=Strict".</span> <span data-start="1202.08" data-end="1204.42">That's one of the ones that we wanted excluded.</span> <span data-start="1205.13" data-end="1207.5">We've got one up here, that is "ck03",</span> <span data-start="1208.21" data-end="1211.3">that is excluded because "SameSite" was unspecified.</span> </p>
<p><span data-start="1211.47" data-end="1212.93">So it was treated as lax.</span> <span data-start="1213.76" data-end="1216.8">The search over here lets you do quite</span> <span data-start="1216.8" data-end="1219.39">a bit. So if I want to find where a particular cookie</span> <span data-start="1220.02" data-end="1222.98">is set, for example, let's say "ck02", I</span> <span data-start="1222.98" data-end="1225.1">can actually just search for that header value.</span> </p>
<p><span data-start="1225.69" data-end="1228.61">So "set-cookie:ck02".</span> <span data-start="1229.9" data-end="1231.15">There it is.</span> <span data-start="1231.61" data-end="1233.99">And then if I just control+F in here as well, for the</span> <span data-start="1233.99" data-end="1237.16">"set-cookie". There you go, you can see</span> <span data-start="1237.28" data-end="1239.24">all of the response cookies.</span> <span data-start="1239.87" data-end="1242.33">And if I look at that, that's my "ck02" one,</span> <span data-start="1243.29" data-end="1245.96">"SameSite=none". That's missing a "Secure" attribute on</span> <span data-start="1245.96" data-end="1247.84">there. And that's it.</span> <span data-start="1248.13" data-end="1250.5">So now you know how to debug your cookie issues.</span> <span data-start="1250.59" data-end="1253.13">And when you find them, you've got the recipe to put them</span> <span data-start="1253.13" data-end="1256.18">right. Remember, it's all about being explicit</span> <span data-start="1256.22" data-end="1258.1">on where you want that cookie sent.</span> <span data-start="1258.85" data-end="1260.1">We've got more on this theme.</span> </p>
<p><span data-start="1260.14" data-end="1262.6">You can watch Eiji's video talking you through some of the</span> <span data-start="1262.6" data-end="1264.81">other resources you can isolate with COOP and COEP.</span> <span data-start="1265.64" data-end="1268.36">And you can also come back to see me and Maud have more</span> <span data-start="1268.69" data-end="1269.73">header related fun.</span> </p>
</section>