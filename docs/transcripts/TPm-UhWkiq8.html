<section>
<p><span data-start="0.56" data-end="3.41">[Music]</span> <span data-start="3.41" data-end="6.14">[Applause]</span> <span data-start="6.14" data-end="13.11">[Music]</span> <span data-start="13.12" data-end="13.679">hello</span> <span data-start="13.679" data-end="15.04">my name is shu and i work on the</span> <span data-start="15.04" data-end="16.96">javascript specification as well as the</span> <span data-start="16.96" data-end="18.08">v8 project</span> <span data-start="18.08" data-end="19.68">my name is lescheck and i work as a</span> <span data-start="19.68" data-end="22.48">performance engineer on the v8 vm</span> <span data-start="22.48" data-end="24.4">so she what's new in javascript these</span> <span data-start="24.4" data-end="25.519">days</span> <span data-start="25.519" data-end="27.119">yeah a whole bunch of stuff has happened</span> <span data-start="27.119" data-end="28.72">since last year and you might recognize</span> <span data-start="28.72" data-end="29.92">some of the features we're going to talk</span> <span data-start="29.92" data-end="32.399">about today from some of our colleagues</span> <span data-start="32.399" data-end="34.8">2019 google i o talk because language</span> <span data-start="34.8" data-end="36.64">features take a while to be standardized</span> <span data-start="36.64" data-end="39.2">and to be shipped into browsers the ones</span> <span data-start="39.2" data-end="40.48">we're going to be talking about today</span> <span data-start="40.48" data-end="41.6">have shipped</span> <span data-start="41.6" data-end="44.879">so let's start with the fun stuff like i</span> <span data-start="44.879" data-end="46">said we're about to</span> <span data-start="46" data-end="47.6">we're either shipped or about to ship</span> <span data-start="47.6" data-end="49.12">quite a few syntax features that should</span> <span data-start="49.12" data-end="51.199">make web devs lives easier</span> <span data-start="51.199" data-end="54.239">for this talk we'll be focusing on two</span> <span data-start="54.239" data-end="55.76">features that'll make dealing with</span> <span data-start="55.76" data-end="56.559">optional</span> <span data-start="56.559" data-end="58.48">values easier so leshik have you ever</span> <span data-start="58.48" data-end="59.84">written code that dealt with</span> <span data-start="59.84" data-end="60.719">configuration</span> <span data-start="60.719" data-end="62.48">oh yeah definitely like always using a</span> <span data-start="62.48" data-end="64">hash map for those things</span> <span data-start="64" data-end="66.24">yeah so i'm keeping i'm writing this new</span> <span data-start="66.24" data-end="67.76">chat app right something of a strength</span> <span data-start="67.76" data-end="69.2">for google engineers</span> <span data-start="69.2" data-end="70.96">i made some network parameters</span> <span data-start="70.96" data-end="73.119">configurable which i keep in this map of</span> <span data-start="73.119" data-end="74.24">configurations called</span> <span data-start="74.24" data-end="76.64">config that you see on the screen but</span> <span data-start="76.64" data-end="78">the network configuration</span> <span data-start="78" data-end="79.84">is optional because it isn't always set</span> <span data-start="79.84" data-end="81.36">by the user and it has</span> <span data-start="81.36" data-end="83.119">sub configurations like the server and</span> <span data-start="83.119" data-end="84.88">the port and maybe those aren't set by</span> <span data-start="84.88" data-end="86.64">the user either handling that kind of</span> <span data-start="86.64" data-end="88.24">optionality is kind of a pain</span> <span data-start="88.24" data-end="90.56">currently folks do this with logical and</span> <span data-start="90.56" data-end="91.6">like you see on the screen</span> <span data-start="91.6" data-end="93.84">oh that's pretty good place yeah and for</span> <span data-start="93.84" data-end="95.6">those chains of property accesses</span> <span data-start="95.6" data-end="97.52">were at any point some property in the</span> <span data-start="97.52" data-end="98.72">middle could turn out to be</span> <span data-start="98.72" data-end="100.88">we added this feature called</span> <span data-start="100.88" data-end="102.399">optional chaining</span> <span data-start="102.399" data-end="104.159">easier to show you on the screen than to</span> <span data-start="104.159" data-end="106.079">talk you through it so</span> <span data-start="106.079" data-end="108.079">the optional chaining feature is the</span> <span data-start="108.079" data-end="109.92">question mark and the dot</span> <span data-start="109.92" data-end="112.72">instead of a plain dot oh i see so if</span> <span data-start="112.72" data-end="114.56">net config is</span> <span data-start="114.56" data-end="116.96">then netconfig.server is  until</span> <span data-start="116.96" data-end="118.96">address isn't defined and so forth</span> <span data-start="118.96" data-end="120.799">yeah almost it's a little bit more</span> <span data-start="120.799" data-end="122.719">relaxed than that it's if it's</span> <span data-start="122.719" data-end="123.36">or null</span> <span data-start="123.36" data-end="125.52">and specifically we call the set of</span> <span data-start="125.52" data-end="126.88">things that are  or not</span> <span data-start="126.88" data-end="127.439">knowledge</span> <span data-start="127.439" data-end="129.679">so in the in this case if net config is</span> <span data-start="129.679" data-end="131.2">knowledge the whole optional chain is</span> <span data-start="131.2" data-end="132"></span> <span data-start="132" data-end="134.12">if net config isn't knowledge but net</span> <span data-start="134.12" data-end="136.08">config.server is knowledge</span> <span data-start="136.08" data-end="137.68">then again the whole thing is</span> <span data-start="137.68" data-end="139.36">you get the idea if nothing</span> <span data-start="139.36" data-end="142">is knowledge then eventually you get the</span> <span data-start="142" data-end="142.72">the</span> <span data-start="142.72" data-end="145.04">whole property the most nested property</span> <span data-start="145.04" data-end="145.84">access</span> <span data-start="145.84" data-end="147.76">yeah cool that's a lot easier to read</span> <span data-start="147.76" data-end="148.879">yeah i think so too</span> <span data-start="148.879" data-end="150.959">now another common feature while dealing</span> <span data-start="150.959" data-end="151.92">with configurations</span> <span data-start="151.92" data-end="153.92">is default values and sometimes folks</span> <span data-start="153.92" data-end="155.92">use logical or for this like you see on</span> <span data-start="155.92" data-end="156.48">the screen</span> <span data-start="156.48" data-end="157.599">oh yeah i've definitely written that</span> <span data-start="157.599" data-end="159.76">before yeah and it usually works fine</span> <span data-start="159.76" data-end="161.68">but sometimes it doesn't and is is</span> <span data-start="161.68" data-end="163.68">really surprising when it doesn't</span> <span data-start="163.68" data-end="165.76">suppose i add a configuration for</span> <span data-start="165.76" data-end="167.2">enabling compression</span> <span data-start="167.2" data-end="170.319">to the to the server do you spot the bug</span> <span data-start="170.319" data-end="172.56">oh yeah right how would you actually</span> <span data-start="172.56" data-end="174.48">explicitly disable compression right</span> <span data-start="174.48" data-end="176.319">if it's false then false or true it's</span> <span data-start="176.319" data-end="177.68">all going to be true</span> <span data-start="177.68" data-end="179.84">yeah exactly if enable compression is</span> <span data-start="179.84" data-end="180.8">false</span> <span data-start="180.8" data-end="183.519">false or true like you said is true so</span> <span data-start="183.519" data-end="185.2">what we really want to test here</span> <span data-start="185.2" data-end="187.84">is not something is truthy which is what</span> <span data-start="187.84" data-end="188.56">logical or</span> <span data-start="188.56" data-end="190.879">tests for but actually if something is</span> <span data-start="190.879" data-end="192.319">absent or present</span> <span data-start="192.319" data-end="194.4">and we already are familiar with that</span> <span data-start="194.4" data-end="196.72">concept that's knowledge</span> <span data-start="196.72" data-end="198.8">so we introduced this new syntax feature</span> <span data-start="198.8" data-end="200.319">called knowledge coalescing which is the</span> <span data-start="200.319" data-end="201.599">two question marks</span> <span data-start="201.599" data-end="203.519">and that does exactly what you want here</span> <span data-start="203.519" data-end="205.44">for default values it tests for</span> <span data-start="205.44" data-end="207.04">knowledgeness on the left-hand side</span> <span data-start="207.04" data-end="208.959">if the left-hand side is knowledge then</span> <span data-start="208.959" data-end="210.56">it evaluates to the right-hand side</span> <span data-start="210.56" data-end="213.12">if the hand side is not knowledge then</span> <span data-start="213.12" data-end="214.159">the whole thing is</span> <span data-start="214.159" data-end="216.08">so in this case enable</span> <span data-start="216.08" data-end="217.92">compression is false question mark</span> <span data-start="217.92" data-end="219.12">question mark true</span> <span data-start="219.12" data-end="220.959">will still get you false because false</span> <span data-start="220.959" data-end="222.799">is not null or</span> <span data-start="222.799" data-end="224.879">but if enable compression wasn't present</span> <span data-start="224.879" data-end="226">if it's</span> <span data-start="226" data-end="228.319">then you get the default value of true</span> <span data-start="228.319" data-end="230.159">that's pretty cool where can i use it</span> <span data-start="230.159" data-end="231.92">so you can use both optional chaining</span> <span data-start="231.92" data-end="233.2">and knowledge coalescing</span> <span data-start="233.2" data-end="235.92">in chrome stable today now enough</span> <span data-start="235.92" data-end="236.799">talking for me</span> <span data-start="236.799" data-end="238.799">this that was just a taste of the new</span> <span data-start="238.799" data-end="240.319">features you can find more on our</span> <span data-start="240.319" data-end="242">website later we'll show you the link</span> <span data-start="242" data-end="243.92">but you know we add all these new syntax</span> <span data-start="243.92" data-end="245.68">features and i'm worried that supporting</span> <span data-start="245.68" data-end="247.36">them all will slow down the parser</span> <span data-start="247.36" data-end="250.08">v8 is known to be fast and i don't want</span> <span data-start="250.08" data-end="250.48">to</span> <span data-start="250.48" data-end="252.4">do anything to make it slower you know</span> <span data-start="252.4" data-end="254.4">what that's a fair concern to have</span> <span data-start="254.4" data-end="257.44">uh when we shipped es6 back in 2015</span> <span data-start="257.44" data-end="259.04">we actually saw a big parsing</span> <span data-start="259.04" data-end="260.32">performance drop like this is measured</span> <span data-start="260.32" data-end="262.8">on octane on the code load benchmark</span> <span data-start="262.8" data-end="265.28">and we had this big drop during this</span> <span data-start="265.28" data-end="266.639">implementation phase</span> <span data-start="266.639" data-end="269.84">but actually nowadays parsing speed</span> <span data-start="269.84" data-end="271.6">doesn't matter as much as you might</span> <span data-start="271.6" data-end="273.919">think oh really not anymore i thought</span> <span data-start="273.919" data-end="275.6">parsing was pretty expensive but it's</span> <span data-start="275.6" data-end="276.96">still not cheap</span> <span data-start="276.96" data-end="278.32">but in the past year we've worked a lot</span> <span data-start="278.32" data-end="279.759">to move a lot of parsing off of the main</span> <span data-start="279.759" data-end="280.4">thread</span> <span data-start="280.4" data-end="281.52">and be able to pass scripts while</span> <span data-start="281.52" data-end="283.199">they're still loading so imagine that</span> <span data-start="283.199" data-end="285.04">chrome sees a script like this</span> <span data-start="285.04" data-end="287.52">the html parser gets up to it it sees</span> <span data-start="287.52" data-end="288.08">the script</span> <span data-start="288.08" data-end="290.08">and then has to pause the html parsing</span> <span data-start="290.08" data-end="291.6">has to download to the script</span> <span data-start="291.6" data-end="293.36">pause it execute it and only then can it</span> <span data-start="293.36" data-end="295.36">continue pausing the html</span> <span data-start="295.36" data-end="297.759">i know is strictly true because of</span> <span data-start="297.759" data-end="299.6">optimizations like preloading</span> <span data-start="299.6" data-end="301.6">no you're absolutely right uh this isn't</span> <span data-start="301.6" data-end="302.8">actually the whole truth and</span> <span data-start="302.8" data-end="304.24">the download of the script happens a lot</span> <span data-start="304.24" data-end="306.4">earlier if there's a link preload or if</span> <span data-start="306.4" data-end="308.479">the preposit finds the script earlier</span> <span data-start="308.479" data-end="310.88">and if the download moves off of the</span> <span data-start="310.88" data-end="312.16">main thread and earlier</span> <span data-start="312.16" data-end="313.919">in time then pause and execute can move</span> <span data-start="313.919" data-end="315.84">earlier too but the thing is the parsing</span> <span data-start="315.84" data-end="316.639">itself</span> <span data-start="316.639" data-end="318.479">can happen on a separate thread as well</span> <span data-start="318.479" data-end="319.919">it's only really the execute that has</span> <span data-start="319.919" data-end="321.199">happened on the main thread</span> <span data-start="321.199" data-end="323.12">in particular if a script is marked as</span> <span data-start="323.12" data-end="325.68">async you can keep processing the html</span> <span data-start="325.68" data-end="327.84">up until uh the parsing of the async</span> <span data-start="327.84" data-end="329.199">script is actually finished and</span> <span data-start="329.199" data-end="331.039">it needs to execute and we've had</span> <span data-start="331.039" data-end="333.28">support for this basically forever but</span> <span data-start="333.28" data-end="335.36">it's been very limited</span> <span data-start="335.36" data-end="337.36">we've only been able to concurrently</span> <span data-start="337.36" data-end="338.479">pass one</span> <span data-start="338.479" data-end="340.32">script at a time and we've only been</span> <span data-start="340.32" data-end="341.919">able to do this very soon scripts</span> <span data-start="341.919" data-end="343.759">yeah how come it's been so limited</span> <span data-start="343.759" data-end="345.759">honestly just historical technical</span> <span data-start="345.759" data-end="348.08">reasons which don't really hold anymore</span> <span data-start="348.08" data-end="349.44">so one of the first things that we did</span> <span data-start="349.44" data-end="351.6">was move everything from this dedicated</span> <span data-start="351.6" data-end="352">thread</span> <span data-start="352" data-end="354.4">into our global threat pool which meant</span> <span data-start="354.4" data-end="355.6">that they could happen</span> <span data-start="355.6" data-end="357.52">at the same time in parallel another</span> <span data-start="357.52" data-end="358.96">thing that we changed was</span> <span data-start="358.96" data-end="361.039">to have synchronous script also use this</span> <span data-start="361.039" data-end="363.12">off-thread pausing functionality</span> <span data-start="363.12" data-end="365.44">i'm kind of confused you said</span> <span data-start="365.44" data-end="367.12">synchronous scripts but what's the point</span> <span data-start="367.12" data-end="368.319">of parsing</span> <span data-start="368.319" data-end="370">synchronous scripts in another thread</span> <span data-start="370" data-end="371.919">isn't the whole point for non-async</span> <span data-start="371.919" data-end="373.919">scripts that they block the main thread</span> <span data-start="373.919" data-end="376.16">well that is the point for the execute</span> <span data-start="376.16" data-end="377.6">but for the parsing</span> <span data-start="377.6" data-end="379.52">even though we're pausing on a different</span> <span data-start="379.52" data-end="381.28">thread if the main thread is free that</span> <span data-start="381.28" data-end="382.479">means it can do other things</span> <span data-start="382.479" data-end="384.8">it means that the user can scroll it</span> <span data-start="384.8" data-end="386.8">means that the user can type it means</span> <span data-start="386.8" data-end="388.479">that we can execute other javascript</span> <span data-start="388.479" data-end="388.8">like</span> <span data-start="388.8" data-end="391.759">on click handlers so it's actually very</span> <span data-start="391.759" data-end="392.639">useful to be</span> <span data-start="392.639" data-end="393.919">to have this empty space here on the</span> <span data-start="393.919" data-end="395.759">main thread ah okay i see</span> <span data-start="395.759" data-end="397.6">this is the difference between improving</span> <span data-start="397.6" data-end="399.68">interactivity versus just improving the</span> <span data-start="399.68" data-end="400.4">loading time</span> <span data-start="400.4" data-end="402.479">right but we can improve loading as well</span> <span data-start="402.479" data-end="403.919">uh because the parsing is happening on a</span> <span data-start="403.919" data-end="405.52">separate thread uh we can actually move</span> <span data-start="405.52" data-end="407.039">it earlier we can start pausing when the</span> <span data-start="407.039" data-end="408.08">download starts</span> <span data-start="408.08" data-end="409.599">and then as data comes in from the</span> <span data-start="409.599" data-end="412.16">network we can feed it into the parser</span> <span data-start="412.16" data-end="414.08">and then the actual pass time doesn't</span> <span data-start="414.08" data-end="415.68">matter as much as you might think</span> <span data-start="415.68" data-end="417.52">all that we need is for the parser to be</span> <span data-start="417.52" data-end="418.96">faster than the network</span> <span data-start="418.96" data-end="421.039">really the networks are already pretty</span> <span data-start="421.039" data-end="423.039">fast not always but usually they are</span> <span data-start="423.039" data-end="425.12">fair enough and you know caches are even</span> <span data-start="425.12" data-end="426.4">faster so</span> <span data-start="426.4" data-end="428.319">we can't completely ignore parser</span> <span data-start="428.319" data-end="430.8">performance so we have invested a lot</span> <span data-start="430.8" data-end="432.24">into improving the positive performance</span> <span data-start="432.24" data-end="433.52">as well single threaded puzzle</span> <span data-start="433.52" data-end="434.08">performance</span> <span data-start="434.08" data-end="436.4">starting 2018 we put this big effort in</span> <span data-start="436.4" data-end="438.08">put some of our best engineers on it</span> <span data-start="438.08" data-end="440.4">and we've had actually very good results</span> <span data-start="440.4" data-end="441.919">in improving past performance just</span> <span data-start="441.919" data-end="442.4">through</span> <span data-start="442.4" data-end="445.52">programming optimization yeah up and to</span> <span data-start="445.52" data-end="447.039">the right that's the kind of graph i</span> <span data-start="447.039" data-end="447.84">like to see</span> <span data-start="447.84" data-end="449.52">really fascinating stuff the thing i</span> <span data-start="449.52" data-end="451.44">learned quite a bit in just the past</span> <span data-start="451.44" data-end="452.96">five minutes about making parsing</span> <span data-start="452.96" data-end="454.319">compiling faster</span> <span data-start="454.319" data-end="456.639">and web app performance in general and</span> <span data-start="456.639" data-end="458.319">you got me thinking about this other big</span> <span data-start="458.319" data-end="458.8">chunk</span> <span data-start="458.8" data-end="461.919">of web app performance which is memory i</span> <span data-start="461.919" data-end="463.28">was doing this thing the other day with</span> <span data-start="463.28" data-end="464.879">with my chat app</span> <span data-start="464.879" data-end="466.8">and you know i got it basically working</span> <span data-start="466.8" data-end="467.919">and i was trying to measure</span> <span data-start="467.919" data-end="469.52">the performance of the packets that i</span> <span data-start="469.52" data-end="472.24">was getting from the server i wrote this</span> <span data-start="472.24" data-end="474.08">little moving average class to compute</span> <span data-start="474.08" data-end="475.599">the latency moving average</span> <span data-start="475.599" data-end="477.919">of uh of the packets that i was getting</span> <span data-start="477.919" data-end="478.879">from the websocket</span> <span data-start="478.879" data-end="481.28">you see there that i add a message</span> <span data-start="481.28" data-end="483.28">listener that basically all it does is</span> <span data-start="483.28" data-end="485.52">it accumulates events into the event</span> <span data-start="485.52" data-end="486.4">array</span> <span data-start="486.4" data-end="489.039">and i use that later in this compute</span> <span data-start="489.039" data-end="490.479">function which i don't show to actually</span> <span data-start="490.479" data-end="492.24">compute the moving average</span> <span data-start="492.24" data-end="493.84">and the way i use that is i have this</span> <span data-start="493.84" data-end="495.44">component that</span> <span data-start="495.44" data-end="498.24">when i start measuring and i want to see</span> <span data-start="498.24" data-end="500">the live statistics of the</span> <span data-start="500" data-end="501.84">moving average of the latency that i</span> <span data-start="501.84" data-end="503.12">make a new instance of it</span> <span data-start="503.12" data-end="504.96">and then when i stop i null it out</span> <span data-start="504.96" data-end="506.16">because i don't want to keep all the</span> <span data-start="506.16" data-end="508">events i accumulated in memory i know</span> <span data-start="508" data-end="508.56">that</span> <span data-start="508.56" data-end="511.44">v8 garbage collects memory that can no</span> <span data-start="511.44" data-end="512.64">longer be reachable</span> <span data-start="512.64" data-end="514.56">and as long as the moving average is</span> <span data-start="514.56" data-end="515.919">reachable through the</span> <span data-start="515.919" data-end="517.76">this.moving average property on the</span> <span data-start="517.76" data-end="519.12">moving average component</span> <span data-start="519.12" data-end="520.479">that the garbage collector cannot</span> <span data-start="520.479" data-end="522.32">collect it which is why no doubt</span> <span data-start="522.32" data-end="524.159">that makes a lot of sense to me yeah and</span> <span data-start="524.159" data-end="525.44">i thought this would work fine</span> <span data-start="525.44" data-end="526.959">but then what happened was you know it's</span> <span data-start="526.959" data-end="529.12">a chat app i kept it open for a while</span> <span data-start="529.12" data-end="529.6">and i</span> <span data-start="529.6" data-end="531.839">opened the memory pane i see every once</span> <span data-start="531.839" data-end="532.8">in a while that</span> <span data-start="532.8" data-end="535.92">a gc happens and it moves you know it</span> <span data-start="535.92" data-end="538">it collects some memory the memory goes</span> <span data-start="538" data-end="539.12">down a little bit</span> <span data-start="539.12" data-end="542.32">but it's pretty clear that the trend is</span> <span data-start="542.32" data-end="543.6">up and to the right this is one of those</span> <span data-start="543.6" data-end="544.88">graphs where up into the right is</span> <span data-start="544.88" data-end="546">actually bad</span> <span data-start="546" data-end="548.24">and what this was basically showing me</span> <span data-start="548.24" data-end="549.839">is that it's a memory leak</span> <span data-start="549.839" data-end="551.839">right that every g every time gc</span> <span data-start="551.839" data-end="554.24">happened it wasn't able to collect all</span> <span data-start="554.24" data-end="555.92">the memory so i just kept accumulating</span> <span data-start="555.92" data-end="557.279">more and more memory and</span> <span data-start="557.279" data-end="559.76">eventually if i kept this chat app open</span> <span data-start="559.76" data-end="560.72">for</span> <span data-start="560.72" data-end="563.279">another day or so my computer will have</span> <span data-start="563.279" data-end="564.32">random memory</span> <span data-start="564.32" data-end="566.88">memory leaks but v8 only collects</span> <span data-start="566.88" data-end="568.399">objects that you can actually reach</span> <span data-start="568.399" data-end="571.04">you node out your moving average uh</span> <span data-start="571.04" data-end="572.08">field</span> <span data-start="572.08" data-end="573.519">so the garbage collector should be able</span> <span data-start="573.519" data-end="575.12">to reclaim its memory shouldn't that</span> <span data-start="575.12" data-end="577.04">yeah so it's a common mistake but it's</span> <span data-start="577.04" data-end="578.959">still pretty subtle i'm sure the</span> <span data-start="578.959" data-end="580.959">more seasoned web developer would have</span> <span data-start="580.959" data-end="582.16">spotted it right away</span> <span data-start="582.16" data-end="584.64">so what's going on is that the websocket</span> <span data-start="584.64" data-end="586.72">is holding on to all the event listeners</span> <span data-start="586.72" data-end="589.6">strongly which means that until they are</span> <span data-start="589.6" data-end="591.04">explicitly removed</span> <span data-start="591.04" data-end="593.04">everything that is reachable via the</span> <span data-start="593.04" data-end="594.8">event listener is also considered</span> <span data-start="594.8" data-end="595.92">reachable and thus</span> <span data-start="595.92" data-end="598.24">not collectible by the garbage collector</span> <span data-start="598.24" data-end="600.279">so you see that use of</span> <span data-start="600.279" data-end="602.56">this.events.push inside the event</span> <span data-start="602.56" data-end="603.12">listener</span> <span data-start="603.12" data-end="605.68">as long as that use is inside there the</span> <span data-start="605.68" data-end="607.44">whole moving average instance</span> <span data-start="607.44" data-end="609.44">is reachable from within the event</span> <span data-start="609.44" data-end="610.72">listener and thus</span> <span data-start="610.72" data-end="613.279">not garbage collectible so even when i</span> <span data-start="613.279" data-end="614.16">nulled it out</span> <span data-start="614.16" data-end="616.079">in the moving average component it was</span> <span data-start="616.079" data-end="618.24">still considered alive by the garbage</span> <span data-start="618.24" data-end="619.279">collector</span> <span data-start="619.279" data-end="622.399">to deal with this folks often use what's</span> <span data-start="622.399" data-end="624.48">called a disposable pattern where i have</span> <span data-start="624.48" data-end="627.36">a a method that manually removes the</span> <span data-start="627.36" data-end="629.839">event listener called dispose</span> <span data-start="629.839" data-end="632">and that's kind of annoying and to use</span> <span data-start="632" data-end="633.92">that the way i would do it is before i</span> <span data-start="633.92" data-end="635.44">null it out in the moving average</span> <span data-start="635.44" data-end="636.32">components</span> <span data-start="636.32" data-end="638.16">i would have to remember to manually</span> <span data-start="638.16" data-end="639.36">call dot bespoke</span> <span data-start="639.36" data-end="641.04">what is this c plus plus you have to</span> <span data-start="641.04" data-end="642.399">manually manage your memory although the</span> <span data-start="642.399" data-end="643.519">whole point of calculation was that you</span> <span data-start="643.519" data-end="644.56">don't have to bother with that sort of</span> <span data-start="644.56" data-end="645.04">stuff</span> <span data-start="645.04" data-end="647.2">yeah exactly and it's so easy to forget</span> <span data-start="647.2" data-end="648.079">it too</span> <span data-start="648.079" data-end="650">and this is all because the event</span> <span data-start="650" data-end="651.76">listeners can't be garbage collected</span> <span data-start="651.76" data-end="653.839">until you manually remove them so what</span> <span data-start="653.839" data-end="655.92">if there was a way to actually tell the</span> <span data-start="655.92" data-end="656.88">engine</span> <span data-start="656.88" data-end="658.32">don't let me keep you from garbage</span> <span data-start="658.32" data-end="660.079">collecting this thing even though</span> <span data-start="660.079" data-end="661.92">it's reachable then you don't have to</span> <span data-start="661.92" data-end="664">remember to manually call dispose</span> <span data-start="664" data-end="666.56">or even need the disposable pattern and</span> <span data-start="666.56" data-end="667.36">it turns out</span> <span data-start="667.36" data-end="668.8">there's a new standard feature in</span> <span data-start="668.8" data-end="671.12">javascript that lets you do exactly this</span> <span data-start="671.12" data-end="673.36">weak rifts all right and before we go</span> <span data-start="673.36" data-end="675.12">into that i have to give a quick</span> <span data-start="675.12" data-end="676.8">disclaimer so we graphs are advanced</span> <span data-start="676.8" data-end="677.92">feature that's hard to use correctly</span> <span data-start="677.92" data-end="678.72">because garbage collection is</span> <span data-start="678.72" data-end="679.76">unpredictable and very different from</span> <span data-start="679.76" data-end="680.64">browser browser</span> <span data-start="680.64" data-end="682.64">and even from even different from front</span> <span data-start="682.64" data-end="683.839">to run of the same browser because of</span> <span data-start="683.839" data-end="685.44">that unpredictability we didn't add weak</span> <span data-start="685.44" data-end="686.8">drafts to the web for many years</span> <span data-start="686.8" data-end="688.48">and you hopefully will never run into a</span> <span data-start="688.48" data-end="690">memory leak or a bug that legibility</span> <span data-start="690" data-end="691.04">needs it but on the rare</span> <span data-start="691.04" data-end="692.399">occasion that you actually legitimately</span> <span data-start="692.399" data-end="695.04">need a weak graph finally you can use it</span> <span data-start="695.04" data-end="696.959">and fix your problem at the root all</span> <span data-start="696.959" data-end="698.48">right back to</span> <span data-start="698.48" data-end="701.519">the main programming so how am i using</span> <span data-start="701.519" data-end="703.2">weak refs here to solve the previous</span> <span data-start="703.2" data-end="703.6">problem</span> <span data-start="703.6" data-end="706.32">i still have this event listener but now</span> <span data-start="706.32" data-end="708.32">instead of directly registering that</span> <span data-start="708.32" data-end="709.92">event listener function</span> <span data-start="709.92" data-end="712.72">with the socket i wrap it in a weak ref</span> <span data-start="712.72" data-end="713.839">it is the</span> <span data-start="713.839" data-end="716">what's called the target of the we graph</span> <span data-start="716" data-end="717.04">and inside</span> <span data-start="717.04" data-end="719.76">the actual event listener i deref the</span> <span data-start="719.76" data-end="720.399">weak ref</span> <span data-start="720.399" data-end="723.04">and i call the function and this kind of</span> <span data-start="723.04" data-end="725.04">indirection basically means that</span> <span data-start="725.04" data-end="727.279">the function that is actually holding</span> <span data-start="727.279" data-end="730.36">the moving average component alive via</span> <span data-start="730.36" data-end="731.76">this.events.push</span> <span data-start="731.76" data-end="734.16">is no longer kept from being garbage</span> <span data-start="734.16" data-end="735.519">collected because</span> <span data-start="735.519" data-end="738.16">it is a weakly held reference inside a</span> <span data-start="738.16" data-end="739.04">weak ref</span> <span data-start="739.04" data-end="742">okay what is weakcraft.traff return i</span> <span data-start="742" data-end="742.72">see you're using</span> <span data-start="742.72" data-end="745.04">optional chaining function called syntax</span> <span data-start="745.04" data-end="746.56">here yeah good eye on that</span> <span data-start="746.56" data-end="748.079">that that was not an example that we</span> <span data-start="748.079" data-end="749.839">showed earlier but like</span> <span data-start="749.839" data-end="751.36">optional chaining for property you can</span> <span data-start="751.36" data-end="752.959">also optional chain a</span> <span data-start="752.959" data-end="756.399">function call so if it's  then</span> <span data-start="756.399" data-end="757.839">you don't end up making the call and the</span> <span data-start="757.839" data-end="759.68">whole thing is  but that</span> <span data-start="759.68" data-end="762.399">also suggests that draft here when the</span> <span data-start="762.399" data-end="764">thing is actually collected</span> <span data-start="764" data-end="766.48">will return  to recap here what</span> <span data-start="766.48" data-end="768.16">it basically means is that</span> <span data-start="768.16" data-end="770.8">you have to manually call draft because</span> <span data-start="770.8" data-end="772.079">we're no longer</span> <span data-start="772.079" data-end="774.24">preventing the garbage collector from</span> <span data-start="774.24" data-end="775.519">from collecting</span> <span data-start="775.519" data-end="778.24">the uh the event listener since it's</span> <span data-start="778.24" data-end="779.68">wrapped up in a weak ref</span> <span data-start="779.68" data-end="781.76">so every time you want to access it you</span> <span data-start="781.76" data-end="783.279">have to manually drive</span> <span data-start="783.279" data-end="785.279">and if the garbage collector has</span> <span data-start="785.279" data-end="786.639">collected it then dref</span> <span data-start="786.639" data-end="789.6">will return  okay so in this</span> <span data-start="789.6" data-end="790.079">case</span> <span data-start="790.079" data-end="791.92">the listener is reachable by this dot</span> <span data-start="791.92" data-end="794.079">listener and once a particular moving</span> <span data-start="794.079" data-end="795.92">average instance isn't reachable</span> <span data-start="795.92" data-end="797.92">then the component and the component</span> <span data-start="797.92" data-end="798.959">knows it out</span> <span data-start="798.959" data-end="800.959">then the whole thing can be connected</span> <span data-start="800.959" data-end="803.36">right exactly because we're no longer</span> <span data-start="803.36" data-end="805.2">accidentally keeping moving average</span> <span data-start="805.2" data-end="807.92">alive anymore via the event listener</span> <span data-start="807.92" data-end="810.639">we can go back to what i naively thought</span> <span data-start="810.639" data-end="812.24">would work in the first place when i no</span> <span data-start="812.24" data-end="813.2">longer need</span> <span data-start="813.2" data-end="814.959">all the data in the moving average</span> <span data-start="814.959" data-end="816.639">instance i would just null it out and</span> <span data-start="816.639" data-end="818.56">let the gc do its thing</span> <span data-start="818.56" data-end="821.519">okay no way but hold on but now you've</span> <span data-start="821.519" data-end="822.56">got this</span> <span data-start="822.56" data-end="825.68">strongly held listener uh on the actual</span> <span data-start="825.68" data-end="827.36">event listener that's calling the weak</span> <span data-start="827.36" data-end="828">graph</span> <span data-start="828" data-end="830.639">yeah that's a it's that's a good point</span> <span data-start="830.639" data-end="831.76">you know i thought</span> <span data-start="831.76" data-end="833.36">you wouldn't spot that but that's</span> <span data-start="833.36" data-end="835.279">exactly right even though</span> <span data-start="835.279" data-end="837.92">with this weak rift in direction i still</span> <span data-start="837.92" data-end="839.76">have this event listener remember the</span> <span data-start="839.76" data-end="841.839">socket still keeps strongly it just</span> <span data-start="841.839" data-end="843.199">holds on to all the event listeners</span> <span data-start="843.199" data-end="843.76">until i</span> <span data-start="843.76" data-end="846.079">register it i still have this extra</span> <span data-start="846.079" data-end="846.959">event listener</span> <span data-start="846.959" data-end="848.72">so what do i do there there is a</span> <span data-start="848.72" data-end="850.48">companion feature to wikraps called</span> <span data-start="850.48" data-end="852.88">finalization registry that lets me do</span> <span data-start="852.88" data-end="855.36">the thing that's needed which is i want</span> <span data-start="855.36" data-end="857.199">the garbage collector to tell me</span> <span data-start="857.199" data-end="859.519">when it has collected something so that</span> <span data-start="859.519" data-end="861.04">i can perform some action</span> <span data-start="861.04" data-end="862.88">at the point that an object has been</span> <span data-start="862.88" data-end="865.04">collected or in gc parlance</span> <span data-start="865.04" data-end="867.12">finalized that feature is called</span> <span data-start="867.12" data-end="869.12">finalization registry</span> <span data-start="869.12" data-end="871.68">on this slide what you see is that i</span> <span data-start="871.68" data-end="873.92">make a finalization registry</span> <span data-start="873.92" data-end="876.56">and when i add the new event listener i</span> <span data-start="876.56" data-end="878.48">also register with the finalization</span> <span data-start="878.48" data-end="879.76">registry meaning</span> <span data-start="879.76" data-end="881.839">when the inner listener the thing that</span> <span data-start="881.839" data-end="884">actually does the this.events.push is</span> <span data-start="884" data-end="885.68">collected and remember it's collectible</span> <span data-start="885.68" data-end="886.72">now because it's</span> <span data-start="886.72" data-end="888.8">held in a weak ref when that's collected</span> <span data-start="888.8" data-end="890.24">it's going to run this</span> <span data-start="890.24" data-end="892.24">function that i passed the finalization</span> <span data-start="892.24" data-end="894.24">registry asynchronously</span> <span data-start="894.24" data-end="896.88">to remove the event listener cleaning up</span> <span data-start="896.88" data-end="898.079">all the excess memory</span> <span data-start="898.079" data-end="899.76">now again this is an advanced feature</span> <span data-start="899.76" data-end="901.92">and hopefully you'll never need it</span> <span data-start="901.92" data-end="903.92">so it doesn't actually pass the object</span> <span data-start="903.92" data-end="906.32">itself into the finalizer there's a good</span> <span data-start="906.32" data-end="906.88">uh</span> <span data-start="906.88" data-end="908.72">observation there you see that the thing</span> <span data-start="908.72" data-end="910.8">that actually gets past the finalizer</span> <span data-start="910.8" data-end="913.519">are some other values the object that</span> <span data-start="913.519" data-end="914.399">you want to</span> <span data-start="914.399" data-end="915.76">observe the finalization of that's</span> <span data-start="915.76" data-end="917.12">already been collected so you don't get</span> <span data-start="917.12" data-end="918">that back</span> <span data-start="918" data-end="919.44">in this case the thing we need to</span> <span data-start="919.44" data-end="921.279">perform the finalization action to</span> <span data-start="921.279" data-end="922.24">unregister</span> <span data-start="922.24" data-end="924.079">are the socket and the wrapper listener</span> <span data-start="924.079" data-end="925.44">and that's what we pass to the</span> <span data-start="925.44" data-end="926">finalization</span> <span data-start="926" data-end="928.16">registry all right that makes sense yeah</span> <span data-start="928.16" data-end="929.6">and like i said this is a</span> <span data-start="929.6" data-end="932.399">this is an advanced feature and this</span> <span data-start="932.399" data-end="934.079">example here is pretty dense</span> <span data-start="934.079" data-end="936.399">i recommend that you follow the link on</span> <span data-start="936.399" data-end="937.759">the screen there to</span> <span data-start="937.759" data-end="940.24">follow our full explainer on the v8.dev</span> <span data-start="940.24" data-end="941.759">website for the feature</span> <span data-start="941.759" data-end="944.32">so with all of that work i opened up the</span> <span data-start="944.32" data-end="945.68">memory panel again i</span> <span data-start="945.68" data-end="948.399">kept my chat app on for a while i start</span> <span data-start="948.399" data-end="950.079">and stop measuring the latency</span> <span data-start="950.079" data-end="953.279">and now i see that every time a gc does</span> <span data-start="953.279" data-end="953.68">happen</span> <span data-start="953.68" data-end="955.759">it's able to reclaim basically all the</span> <span data-start="955.759" data-end="956.72">memory and then</span> <span data-start="956.72" data-end="958.399">over a longer period of time i'm no</span> <span data-start="958.399" data-end="960.16">longer accumulating memory</span> <span data-start="960.16" data-end="962.72">and yeah it looks like i fixed the leak</span> <span data-start="962.72" data-end="964.48">looks pretty tricky like i've</span> <span data-start="964.48" data-end="966.48">collected garbage before and i don't do</span> <span data-start="966.48" data-end="968.24">it particularly deterministically myself</span> <span data-start="968.24" data-end="969.6">yes garbage collection is not</span> <span data-start="969.6" data-end="971.199">predictable it's not it's</span> <span data-start="971.199" data-end="972.88">non-deterministic don't depend on</span> <span data-start="972.88" data-end="975.279">always running and that's why we we have</span> <span data-start="975.279" data-end="976.399">kept saying that</span> <span data-start="976.399" data-end="978.72">we crafts and finalization registry is</span> <span data-start="978.72" data-end="980.24">an advanced feature</span> <span data-start="980.24" data-end="983.12">so and that's a good point too um given</span> <span data-start="983.12" data-end="984.639">the unpredictability of the garbage</span> <span data-start="984.639" data-end="986.639">collector are there other things that</span> <span data-start="986.639" data-end="989.519">the engine does to make apps slimmer</span> <span data-start="989.519" data-end="991.12">actually yeah basically doing a lot of</span> <span data-start="991.12" data-end="992.72">work to reduce its memory consumption</span> <span data-start="992.72" data-end="994.16">there's actually been two major projects</span> <span data-start="994.16" data-end="997.199">that landed last year which have focused</span> <span data-start="997.199" data-end="999.199">on this points compression and v8 light</span> <span data-start="999.199" data-end="1000.24">and i can actually talk about both of</span> <span data-start="1000.24" data-end="1002.079">them very quickly</span> <span data-start="1002.079" data-end="1004.8">so point to compression first of all um</span> <span data-start="1004.8" data-end="1005.44">you've probably</span> <span data-start="1005.44" data-end="1009.36">heard that machines are 32-bit or 64-bit</span> <span data-start="1009.36" data-end="1011.36">on 32-bit machines we have 32-bit</span> <span data-start="1011.36" data-end="1013.12">pointers on 64-bit machines we have</span> <span data-start="1013.12" data-end="1014.639">64-bit pointers</span> <span data-start="1014.639" data-end="1017.6">and the whole point of this pun intended</span> <span data-start="1017.6" data-end="1018.16">is that</span> <span data-start="1018.16" data-end="1020.399">32-bit pointers can reference up to 4</span> <span data-start="1020.399" data-end="1021.6">gigabytes of memory</span> <span data-start="1021.6" data-end="1024.4">64-bit pointers can reference up to 18</span> <span data-start="1024.4" data-end="1026.16">exabytes of memory which</span> <span data-start="1026.16" data-end="1029.6">is quite a lot more and chrome wants to</span> <span data-start="1029.6" data-end="1030.48">be able to run</span> <span data-start="1030.48" data-end="1033.12">in 64-bit so that it can access more</span> <span data-start="1033.12" data-end="1034.559">than four gigabytes of memory</span> <span data-start="1034.559" data-end="1036.24">yeah chrome definitely needs more than</span> <span data-start="1036.24" data-end="1038.4">four gigs yeah all right</span> <span data-start="1038.4" data-end="1040.559">we've all heard we've all seen the same</span> <span data-start="1040.559" data-end="1041.52">memes and</span> <span data-start="1041.52" data-end="1042.959">you know fair enough if you've got a</span> <span data-start="1042.959" data-end="1044.64">hundred times open with a thousand</span> <span data-start="1044.64" data-end="1046.24">images and they're playing games and</span> <span data-start="1046.24" data-end="1047.919">they're playing music</span> <span data-start="1047.919" data-end="1051.2">it's going to use our memory but</span> <span data-start="1051.2" data-end="1053.12">not necessarily each individual tab not</span> <span data-start="1053.12" data-end="1054.64">necessarily each individual</span> <span data-start="1054.64" data-end="1057.36">v8 instance and the key observation of</span> <span data-start="1057.36" data-end="1059.2">point compression is that actually</span> <span data-start="1059.2" data-end="1061.2">we can probably restrict each va</span> <span data-start="1061.2" data-end="1062.24">instance to</span> <span data-start="1062.24" data-end="1064.16">be less than four gig and if we can</span> <span data-start="1064.16" data-end="1066.24">restrict it to be less than 4 gig</span> <span data-start="1066.24" data-end="1068.16">that means we can pre-allocate a 4 gig</span> <span data-start="1068.16" data-end="1070.559">area for it and force all objects to be</span> <span data-start="1070.559" data-end="1072.24">allocated inside of that area</span> <span data-start="1072.24" data-end="1074">and now instead of referencing those</span> <span data-start="1074" data-end="1075.919">objects by a 64-bit pointer</span> <span data-start="1075.919" data-end="1077.52">we can reference them by an offset like</span> <span data-start="1077.52" data-end="1079.76">this under pointer compression</span> <span data-start="1079.76" data-end="1081.36">you can take your 64-bit pointer and</span> <span data-start="1081.36" data-end="1083.2">then you can split it in half</span> <span data-start="1083.2" data-end="1085.12">you can split it into a base and an</span> <span data-start="1085.12" data-end="1086.96">offset the base is the start of that</span> <span data-start="1086.96" data-end="1088.48">four giga allocation area and the offset</span> <span data-start="1088.48" data-end="1090.08">is the offset within it</span> <span data-start="1090.08" data-end="1091.44">and then you only have to store the</span> <span data-start="1091.44" data-end="1092.799">offset on objects which means that your</span> <span data-start="1092.799" data-end="1093.6">pointers go</span> <span data-start="1093.6" data-end="1095.52">half the size they go back to 32-bit</span> <span data-start="1095.52" data-end="1096.96">size</span> <span data-start="1096.96" data-end="1100.24">guessing it wasn't just easy as that it</span> <span data-start="1100.24" data-end="1101.52">definitely wasn't</span> <span data-start="1101.52" data-end="1103.12">it was a whole journey and there's a</span> <span data-start="1103.12" data-end="1104.64">whole blog post describing that journey</span> <span data-start="1104.64" data-end="1106.4">which was very exciting</span> <span data-start="1106.4" data-end="1108.96">but as a little spoiler i can tell you</span> <span data-start="1108.96" data-end="1110.88">that on typical websites</span> <span data-start="1110.88" data-end="1113.679">we reduce memory by about forty percent</span> <span data-start="1113.679" data-end="1115.12">yeah that's uh those are some very</span> <span data-start="1115.12" data-end="1116.64">impressive numbers forty percent</span> <span data-start="1116.64" data-end="1118.96">but what if a web app or an ogs program</span> <span data-start="1118.96" data-end="1120.64">really wants to use more than</span> <span data-start="1120.64" data-end="1122.559">the four gigs are you constricting apps</span> <span data-start="1122.559" data-end="1124.72">to only have four gigs of memory</span> <span data-start="1124.72" data-end="1128.4">well kind of but also not really</span> <span data-start="1128.4" data-end="1129.919">first of all with points compression</span> <span data-start="1129.919" data-end="1131.36">those objects are a lot smaller so you</span> <span data-start="1131.36" data-end="1132">can fit</span> <span data-start="1132" data-end="1133.6">a lot more of them into that four</span> <span data-start="1133.6" data-end="1135.52">gigabyte allocation area and also</span> <span data-start="1135.52" data-end="1137.84">this 4 gig only applies to a single v8</span> <span data-start="1137.84" data-end="1138.96">instances</span> <span data-start="1138.96" data-end="1141.679">javascript object heap so for example</span> <span data-start="1141.679" data-end="1142.799">typed arrays</span> <span data-start="1142.799" data-end="1144.64">they have their own external memory</span> <span data-start="1144.64" data-end="1146.24">backing so they're not included</span> <span data-start="1146.24" data-end="1148.32">wasm instances have their own 4 gigabyte</span> <span data-start="1148.32" data-end="1150.559">allocation area so those are separate</span> <span data-start="1150.559" data-end="1152.64">even other va instances inside of web</span> <span data-start="1152.64" data-end="1153.84">workers</span> <span data-start="1153.84" data-end="1156.32">and on other tabs have their own 4gb</span> <span data-start="1156.32" data-end="1157.28">location area</span> <span data-start="1157.28" data-end="1160.24">so only restricting one v8 instance not</span> <span data-start="1160.24" data-end="1160.96">all of them</span> <span data-start="1160.96" data-end="1163.28">the other big project last year was v8</span> <span data-start="1163.28" data-end="1164.32">light</span> <span data-start="1164.32" data-end="1165.679">and this was this was a really</span> <span data-start="1165.679" data-end="1166.88">interesting one because we thought to</span> <span data-start="1166.88" data-end="1167.44">ourselves</span> <span data-start="1167.44" data-end="1169.76">what would happen if we just gave up on</span> <span data-start="1169.76" data-end="1170.72">performance</span> <span data-start="1170.72" data-end="1172.64">and tried to just improve memory how far</span> <span data-start="1172.64" data-end="1173.919">could we actually get</span> <span data-start="1173.919" data-end="1176.16">for memory constrained devices where v8</span> <span data-start="1176.16" data-end="1177.6">just couldn't run at all without the</span> <span data-start="1177.6" data-end="1178.72">memory that it needed</span> <span data-start="1178.72" data-end="1179.84">yeah that's an interesting thought</span> <span data-start="1179.84" data-end="1181.6">experiment i guess if you run slowly</span> <span data-start="1181.6" data-end="1183.12">that's better than not being to run at</span> <span data-start="1183.12" data-end="1184.64">all because you're out of memory right</span> <span data-start="1184.64" data-end="1185.6">absolutely</span> <span data-start="1185.6" data-end="1187.2">the approach that we took was to just</span> <span data-start="1187.2" data-end="1189.44">look at typical websites and</span> <span data-start="1189.44" data-end="1191.12">look at what kind of things arctic</span> <span data-start="1191.12" data-end="1192.799">actually taking up memory there</span> <span data-start="1192.799" data-end="1196">48 was user data there's not</span> <span data-start="1196" data-end="1198.16">really much we can do about that uh</span> <span data-start="1198.16" data-end="1199.44">projects like point compression are</span> <span data-start="1199.44" data-end="1201.2">going to reduce that by a lot</span> <span data-start="1201.2" data-end="1203.12">but we can't really have any targeted</span> <span data-start="1203.12" data-end="1204.64">optimizations that reduce the amount of</span> <span data-start="1204.64" data-end="1205.52">data that users</span> <span data-start="1205.52" data-end="1207.36">create and there's this big bucket of</span> <span data-start="1207.36" data-end="1208.4">other because there's always a big</span> <span data-start="1208.4" data-end="1209.52">bucket called other and we couldn't</span> <span data-start="1209.52" data-end="1210.88">reduce that either with targeted</span> <span data-start="1210.88" data-end="1211.84">optimizations</span> <span data-start="1211.84" data-end="1214.64">but we did look at some of the top users</span> <span data-start="1214.64" data-end="1216.4">of memory and we decided to</span> <span data-start="1216.4" data-end="1218.88">try and target those right so right off</span> <span data-start="1218.88" data-end="1220">the bat if you're not worried about</span> <span data-start="1220" data-end="1221.12">performance at all you don't need to</span> <span data-start="1221.12" data-end="1222.08">optimize code</span> <span data-start="1222.08" data-end="1224.559">that makes sense to me absolutely um and</span> <span data-start="1224.559" data-end="1225.679">if you don't need to optimize code you</span> <span data-start="1225.679" data-end="1226.88">don't need to really collect type</span> <span data-start="1226.88" data-end="1228.4">feedback either because that's just</span> <span data-start="1228.4" data-end="1229.919">storing the data that we need for</span> <span data-start="1229.919" data-end="1231.76">optimization and it's only used for</span> <span data-start="1231.76" data-end="1233.28">performance</span> <span data-start="1233.28" data-end="1235.52">even the bike agent that we generate you</span> <span data-start="1235.52" data-end="1237.039">don't have to store that you can just</span> <span data-start="1237.039" data-end="1238.64">compile it on the fly whenever you need</span> <span data-start="1238.64" data-end="1240.4">it and get rid of it afterwards sounds a</span> <span data-start="1240.4" data-end="1240.88">little</span> <span data-start="1240.88" data-end="1242.72">different to me though by code is</span> <span data-start="1242.72" data-end="1244.72">unoptimized code and if you're even</span> <span data-start="1244.72" data-end="1246.24">getting rid of that that sounds like</span> <span data-start="1246.24" data-end="1247.76">you're giving up more than just a little</span> <span data-start="1247.76" data-end="1248.96">bit of performance</span> <span data-start="1248.96" data-end="1250.96">yeah the first prototypes of v8 light</span> <span data-start="1250.96" data-end="1253.28">were pretty slow</span> <span data-start="1253.28" data-end="1254.96">but then we realized that we could get a</span> <span data-start="1254.96" data-end="1256.559">lot of these gains without actually</span> <span data-start="1256.559" data-end="1258.32">sacrificing performance at all just by</span> <span data-start="1258.32" data-end="1259.919">being a little bit lazier</span> <span data-start="1259.919" data-end="1261.679">yeah i'm something of an expert being</span> <span data-start="1261.679" data-end="1263.6">lazy myself yeah i'm pretty good at</span> <span data-start="1263.6" data-end="1265.039">being lazy myself too</span> <span data-start="1265.039" data-end="1267.84">but as an expert in laziness you know</span> <span data-start="1267.84" data-end="1268.72">right</span> <span data-start="1268.72" data-end="1270.88">that being lazy doesn't just mean not</span> <span data-start="1270.88" data-end="1272.08">doing anything at all</span> <span data-start="1272.08" data-end="1273.84">it means not doing anything until you</span> <span data-start="1273.84" data-end="1275.52">you're really required to</span> <span data-start="1275.52" data-end="1278.24">so we took the same approach with va</span> <span data-start="1278.24" data-end="1279.44">let's talk about those</span> <span data-start="1279.44" data-end="1280.48">feedback factors that i mentioned</span> <span data-start="1280.48" data-end="1282.64">previously the type feedback</span> <span data-start="1282.64" data-end="1284">you're not going to make get much</span> <span data-start="1284" data-end="1285.52">benefit from type feedback if you only</span> <span data-start="1285.52" data-end="1286.72">run a function once or twice</span> <span data-start="1286.72" data-end="1288.159">it's only where you can start benefiting</span> <span data-start="1288.159" data-end="1289.679">you after you run it tens or hundreds of</span> <span data-start="1289.679" data-end="1291.039">times</span> <span data-start="1291.039" data-end="1293.76">so we can delay creating this type</span> <span data-start="1293.76" data-end="1294.88">feedback until</span> <span data-start="1294.88" data-end="1296.08">we've already had a couple of runs of</span> <span data-start="1296.08" data-end="1298.159">this function taking off some of those</span> <span data-start="1298.159" data-end="1299.039">feedback vectors</span> <span data-start="1299.039" data-end="1300.64">but not all of them same thing with</span> <span data-start="1300.64" data-end="1302.32">source positions we only need those</span> <span data-start="1302.32" data-end="1304.32">for printing line numbers when we print</span> <span data-start="1304.32" data-end="1306.72">exception stack traces or for printing</span> <span data-start="1306.72" data-end="1309.12">uh stack traces in devtools so if we can</span> <span data-start="1309.12" data-end="1310.799">delay calculating those two later then</span> <span data-start="1310.799" data-end="1312.559">we save a lot of space as well</span> <span data-start="1312.559" data-end="1314.88">even by code we have this capability of</span> <span data-start="1314.88" data-end="1316.159">getting rid of a bicode that we don't</span> <span data-start="1316.159" data-end="1316.559">need</span> <span data-start="1316.559" data-end="1318.88">so we can just get rid of old bytecode</span> <span data-start="1318.88" data-end="1320.159">keep around by code that we're still</span> <span data-start="1320.159" data-end="1320.559">using</span> <span data-start="1320.559" data-end="1322.24">and save a little bit of memory there</span> <span data-start="1322.24" data-end="1324.32">and there were a bunch of tiny projects</span> <span data-start="1324.32" data-end="1326.48">targeting these top memory users which</span> <span data-start="1326.48" data-end="1327.76">are described in this blog post in a lot</span> <span data-start="1327.76" data-end="1328.799">more detail</span> <span data-start="1328.799" data-end="1330.88">but again spoiler alert they reduce</span> <span data-start="1330.88" data-end="1332.08">memory by 10</span> <span data-start="1332.08" data-end="1335.039">to 30 on typical websites nice so</span> <span data-start="1335.039" data-end="1336.24">there's actually been a lot more going</span> <span data-start="1336.24" data-end="1337.039">on in v8</span> <span data-start="1337.039" data-end="1339.039">in the last year we only had time to</span> <span data-start="1339.039" data-end="1340.4">talk about a couple of projects</span> <span data-start="1340.4" data-end="1342.159">i recommend you visit our blog where we</span> <span data-start="1342.159" data-end="1344.88">post about new versions of v8 we talk</span> <span data-start="1344.88" data-end="1345.44">about</span> <span data-start="1345.44" data-end="1348">exciting new things that we just like to</span> <span data-start="1348" data-end="1348.88">talk about</span> <span data-start="1348.88" data-end="1350.559">it's a great read and we look forward to</span> <span data-start="1350.559" data-end="1352.32">seeing you there thank you very much for</span> <span data-start="1352.32" data-end="1353.919">all the viewers who joined us for this</span> <span data-start="1353.919" data-end="1356">whirlwind tour of</span> <span data-start="1356" data-end="1357.919">the java what's new in the javascript</span> <span data-start="1357.919" data-end="1360.24">language and the new developments in the</span> <span data-start="1360.24" data-end="1361.6">engine itself that makes learning</span> <span data-start="1361.6" data-end="1363.84">javascript both faster and to use less</span> <span data-start="1363.84" data-end="1364.48">memory</span> <span data-start="1364.48" data-end="1365.84">we definitely didn't have time to go</span> <span data-start="1365.84" data-end="1367.12">into all the new features that were</span> <span data-start="1367.12" data-end="1368.96">added to javascript so please give our</span> <span data-start="1368.96" data-end="1369.76">blog</span> <span data-start="1369.76" data-end="1372.84">a read thank you very much thanks</span> <span data-start="1372.84" data-end="1379.39">everyone</span> <span data-start="1379.4" data-end="1381.59">[Applause]</span> <span data-start="1381.59" data-end="1388.87">[Music]</span> </p>
</section>