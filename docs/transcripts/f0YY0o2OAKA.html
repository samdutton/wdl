<section>
<p><span data-start="13.3" data-end="14.3">Hey, I'm Maud.</span> <span data-start="15.55" data-end="18.31">Hey. And I'm Rowan. Now, over the past couple of videos,</span> <span data-start="18.47" data-end="21.35">there's been a pattern where the changes we've been showing</span> <span data-start="21.39" data-end="24.31">you have been to reduce cross-site data transfer</span> <span data-start="24.52" data-end="25.52">by default.</span> <span data-start="25.94" data-end="28.36">And because some of these changes restrict existing</span> <span data-start="28.65" data-end="31.86">behavior, you need to take action if your site relies</span> <span data-start="31.86" data-end="33.32">on that cross-site functionality.</span> <span data-start="33.95" data-end="36.99">So instead of just a list of features, we wanted</span> <span data-start="36.99" data-end="39.04">to give you a little framework for thinking about them,</span> <span data-start="39.04" data-end="41.12">both for now and for the future.</span> <span data-start="41.66" data-end="44.67">So we've brainstormed then finally distilled that down</span> <span data-start="44.71" data-end="47.59">into three questions you can ask yourself and your team.</span> <span data-start="48.34" data-end="51.17">And we'll be running three examples, but first, let's take</span> <span data-start="51.26" data-end="52.55">a look at the raw questions.</span> </p>
<p><span data-start="53.59" data-end="55.72">One, do I need this data?</span> <span data-start="57.81" data-end="59.85">Now, there's definitely a developer temptation to think,</span> <span data-start="60.06" data-end="62.89">just collect all the data. It might be valuable later, but</span> <span data-start="63.35" data-end="65.23">that's not really the right attitude anymore.</span> <span data-start="66.23" data-end="69.03">Right. And you're opening yourself up to more risk if that</span> <span data-start="69.11" data-end="71.99">data leaks. You've got more regulations to follow and</span> <span data-start="72.07" data-end="73.2">it's just more work.</span> <span data-start="73.61" data-end="75.24">So the lazy option is just don't.</span> <span data-start="76.03" data-end="77.87">Don't collect it, no risk.</span> <span data-start="77.91" data-end="78.91">No work.</span> </p>
<p><span data-start="79.49" data-end="81.33">Mm hmm. So we can sum this up as more</span> <span data-start="82.5" data-end="83.71">data, more problems?</span> <span data-start="84.37" data-end="86.5">Yeah. Onto the next question.</span> <span data-start="87.04" data-end="89.46">Question two, then: is there an alternative?</span> <span data-start="90.34" data-end="91.34">There are so many options there, so it depends.</span> </p>
<p><span data-start="93.3" data-end="95.72">Some things like site preferences might be better</span> <span data-start="96.39" data-end="99.01">in client-side storage, like IndexedDB or LocalStorage,</span> <span data-start="99.97" data-end="102.98">so you can still sync them with the server, but maybe</span> <span data-start="102.98" data-end="105.39">you don't need them on every single request.</span> <span data-start="106.06" data-end="108.9">Yeah, and there might be places where the query parameters</span> <span data-start="109.02" data-end="111.57">in the URL make more sense, if it's related to how the</span> <span data-start="111.57" data-end="114.15">content displays, because then if I share a link with</span> <span data-start="114.65" data-end="116.78">you, you get the same options that I have.</span> <span data-start="117.62" data-end="119.12">Sometimes cookies are the right answer, though,</span> <span data-start="120.83" data-end="122.66">so question 3: have I secured it correctly?</span> <span data-start="124.12" data-end="125.33">Oh, I know this one.</span> <span data-start="125.71" data-end="126.71">Watch my video from earlier.</span> </p>
<p><span data-start="127.33" data-end="130.04">Yeah, yeah, okay Rowan, okay — but let's do a summary.</span> <span data-start="130.54" data-end="133.67">So, first-party cookies should try using</span> <span data-start="133.67" data-end="136.22">the __Host- prefix so they're Secure and single-origin,</span> <span data-start="137.39" data-end="140.35">they should use HttpOnly to stop JavaScript</span> <span data-start="140.39" data-end="143.47">access, and they should set SameSite=Lax to</span> <span data-start="143.47" data-end="146.06">protect against cross-site request forgery.</span> </p>
<p><span data-start="147.52" data-end="150.52">And if they do need to be third-party, then try and do the</span> <span data-start="150.52" data-end="153.82">same, but with SameSite=None and Secure.</span> <span data-start="154.78" data-end="155.78">And that's it.</span> <span data-start="156.07" data-end="157.7">Cool. I feel good about this.</span> <span data-start="157.91" data-end="160.12">I think if you're asking these questions, you're headed</span> <span data-start="160.12" data-end="161.12">down the right track.</span> <span data-start="161.91" data-end="165.12">We should repeat these a few times, though, like good</span> <span data-start="165.12" data-end="167.92">scientists to see if it works with different topics.</span> </p>
<p><span data-start="168.96" data-end="172.09">Good idea. I might even have a topic I could talk about</span> <span data-start="172.25" data-end="173.25">right now.</span> <span data-start="173.34" data-end="174.42">Yeah, me too.</span> <span data-start="174.59" data-end="175.59">Okay, you go.</span> <span data-start="176.55" data-end="179.09">OK, first test drive of these questions then — we're</span> <span data-start="179.51" data-end="181.51">going to take a look at the User-Agent string.</span> <span data-start="182.22" data-end="186.14">Now, the original specification for this back in 1996</span> <span data-start="186.23" data-end="188.56">was pretty simple. It was basically a browser version,</span> <span data-start="189.52" data-end="191.19">library version and so on.</span> <span data-start="192.4" data-end="195.36">However, nearly a quarter of a century later, that</span> <span data-start="195.36" data-end="196.86">string has grown a bit.</span> <span data-start="197.49" data-end="200.03">If you want to successfully parse this, then you need a</span> <span data-start="200.07" data-end="203.08">whole bunch of regular expressions or a library</span> <span data-start="203.08" data-end="204.08">that hides them from you.</span> <span data-start="204.83" data-end="207.46">On top of that, the information about your browser and</span> <span data-start="207.5" data-end="209.54">device in that string can be pretty identifying.</span> </p>
<p><span data-start="210.67" data-end="213.25">From my string here, which is being sent on every single</span> <span data-start="213.25" data-end="216.05">request, you can see the exact build of Chrome,</span> <span data-start="216.38" data-end="218.84">the phone I'm using, the version of Android it's running.</span> <span data-start="218.84" data-end="221.76">Now — especially with less common devices — this</span> <span data-start="222.89" data-end="224.22">could be enough to track someone.</span> <span data-start="225.1" data-end="227.52">While we would eventually like to reduce the amount of data</span> <span data-start="227.52" data-end="230.23">exposed there, those 25 years of growth have meant that</span> <span data-start="230.48" data-end="233.27">there's a lot of genuine and valuable use cases out there</span> <span data-start="233.4" data-end="235.86">for the User-Agent string and maintaining backwards</span> <span data-start="236.69" data-end="239.74">compatibility on the web is what means that your modern</span> <span data-start="239.74" data-end="242.74">browser can still show you those 25 year old sites</span> <span data-start="242.74" data-end="244.07">successfully.</span> <span data-start="245.03" data-end="248.16">Right. Let's run the questions and see if it helps us.</span> <span data-start="248.79" data-end="250.21">Number one: do you need it?</span> <span data-start="251.08" data-end="253.13">If you're using the string to try and determine feature</span> <span data-start="253.13" data-end="256.25">support or capabilities, then it's far better</span> <span data-start="256.25" data-end="258.96">to use feature detection, progressive enhancement, or</span> <span data-start="258.96" data-end="261.01">responsive design to achieve those goals.</span> </p>
<p><span data-start="261.68" data-end="264.05">That means you don't need to maintain a mapping between</span> <span data-start="264.05" data-end="266.89">browser version and whatever feature you're checking for.</span> <span data-start="267.68" data-end="270.73">It also means you're less likely to exclude less common</span> <span data-start="270.73" data-end="273.06">browsers just because you couldn't match the string.</span> <span data-start="273.69" data-end="275.61">Question two: is there an alternative?</span> </p>
<p><span data-start="276.32" data-end="278.82">When I mentioned valid use cases before, some of those</span> <span data-start="278.82" data-end="281.78">examples might be matching the user's OS so you can show</span> <span data-start="281.78" data-end="284.49">appropriate downloads or match the UI conventions.</span> <span data-start="285.28" data-end="287.91">You may also need to work around browser bugs where the</span> <span data-start="287.91" data-end="290.75">specific browser version is the key bit of information</span> <span data-start="290.87" data-end="292.29">you need to know if it's been fixed or not.</span> <span data-start="293.29" data-end="296">For this, I want to introduce you to Client Hints, and</span> <span data-start="296" data-end="298.59">specifically the new set of User-Agent Client Hints.</span> </p>
<p><span data-start="299.34" data-end="301.97">Essentially, the idea is we could go from broadcasting</span> <span data-start="302.51" data-end="305.18">all of this information by default to a model where the</span> <span data-start="305.3" data-end="308.31">site asks the browser for each piece of info and</span> <span data-start="308.31" data-end="310.14">the browser decides what it wants to return.</span> <span data-start="310.89" data-end="314.02">With User-Agent Client Hints the default data shared</span> <span data-start="314.02" data-end="317.15">on each request is the browser name, significant version,</span> <span data-start="317.31" data-end="319.57">and the mobile indicator which comes in on these Sec-CH</span> <span data-start="320.53" data-end="323.65">headers. If you want something extra like the OS</span> <span data-start="323.65" data-end="326.32">platform, then your site needs to ask for it.</span> </p>
<p><span data-start="326.87" data-end="329.95">It can do this by sending an Accept-CH header</span> <span data-start="329.95" data-end="332.08">in its response asking for platform.</span> <span data-start="332.87" data-end="336.04">Then, on subsequent requests, the browser will send a</span> <span data-start="336.04" data-end="338.67">Sec-CH-UA-Platform header back.</span> <span data-start="339.25" data-end="341.42">You can also do this in JavaScript by calling</span> <span data-start="341.42" data-end="343.42">getHighEntropyValues() on navigator.userAgentData</span> <span data-start="345.34" data-end="347.55">and passing 'platform' as a parameter.</span> <span data-start="348.35" data-end="351.14">There's one of these User-Agent hints to cover each of the</span> <span data-start="351.14" data-end="353.81">bits of data that you can get from the string — so full</span> <span data-start="353.93" data-end="356.69">browser version, platform version, device model, CPU</span> <span data-start="357.15" data-end="359.98">architecture, on top of the significant version</span> <span data-start="360.23" data-end="361.61">and that mobile indicator.</span> <span data-start="362.61" data-end="363.82">But wait, there's more.</span> </p>
<p><span data-start="364.45" data-end="367.03">There are also existing Client Hints that can give you</span> <span data-start="367.03" data-end="369.07">things like device memory or viewport width.</span> <span data-start="369.74" data-end="372.33">Because even if you're getting the data in the right way,</span> <span data-start="372.41" data-end="375.33">it's easier to ask directly for the thing you want</span> <span data-start="375.54" data-end="377.92">instead of using User-Agent as a proxy.</span> <span data-start="379.42" data-end="382.13">OK, third and final question: have you secured it</span> <span data-start="382.13" data-end="385.13">correctly? For the User-Agent Client Hints they are by</span> <span data-start="385.13" data-end="387.13">default restricted to the same origin.</span> <span data-start="387.59" data-end="390.39">If you have other cross-origin or cross-site requests on</span> <span data-start="390.39" data-end="392.93">that page that need the Client Hints — let's say your</span> <span data-start="392.93" data-end="395.73">downloads are hosted on a separate origin, so you want to</span> <span data-start="395.73" data-end="398.69">send the platform hint there — you need to specify</span> <span data-start="398.73" data-end="402.15">each of the hint and origin pairs in a Feature Policy</span> <span data-start="402.23" data-end="403.19">to allow them through.</span> </p>
<p><span data-start="403.94" data-end="406.4">Now, eventually, we'd like to reduce the amount of</span> <span data-start="406.57" data-end="408.7">information exposed by default in the User-Agent string.</span> <span data-start="409.87" data-end="411.99">So ideally, if you can migrate to User-Agent Client Hints,</span> <span data-start="413.2" data-end="415.16">then that should absolutely be your route.</span> <span data-start="415.66" data-end="418.71">However, if you cannot, then try to be flexible</span> <span data-start="418.71" data-end="419.71">in your detection.</span> <span data-start="420" data-end="423.25">This kind of string parsing is inherently fragile — so</span> <span data-start="423.34" data-end="425.51">feel free to warn me that I might get issues with my</span> <span data-start="425.51" data-end="428.84">browser, but don't block me just because my string</span> <span data-start="428.93" data-end="429.93">didn't match your regex.</span> </p>
<p><span data-start="430.84" data-end="433.1">And there we go: User-Agent, one, two, three.</span> <span data-start="433.31" data-end="435.56">Done. We've got a lot more info on</span> <span data-start="436.27" data-end="437.69">web.dev but let's keep this rolling.</span> <span data-start="437.77" data-end="440.23">And do another round. Maud, over to you.</span> <span data-start="440.9" data-end="441.9">Thanks, Rowan!</span> <span data-start="442.69" data-end="445.65">Now let's look at our second test drive of these questions</span> <span data-start="445.65" data-end="448.9">to see how they work, using an example that's also</span> <span data-start="448.95" data-end="449.95">an HTTP header.</span> <span data-start="450.7" data-end="451.82">It's called the Referer.</span> <span data-start="452.49" data-end="454.95">You'll see it written with either one or two R's.</span> <span data-start="455.58" data-end="458.25">Don't be surprised. This is due to an original misspelling</span> <span data-start="458.25" data-end="459.25">in the spec.</span> </p>
<p><span data-start="459.67" data-end="462">Imagine that a user is visiting a page on site-one.</span> <span data-start="462.75" data-end="465.42">And to load an image, a request to site-two</span> <span data-start="465.96" data-end="468.92">is sent. In some cases, site-two can see the</span> <span data-start="469.38" data-end="472.8">full URL of site-one the user is on in the requests'</span> </p>
<p><span data-start="473.01" data-end="475.51">Referer header, which might be present in all types</span> <span data-start="476.27" data-end="478.68">of requests: navigation or subresource.</span> <span data-start="479.35" data-end="482.19">And this info is not just present in the header.</span> <span data-start="482.56" data-end="485.32">It may be accessed on the destination via JavaScript.</span> <span data-start="486.53" data-end="488.15">The Referer can be insightful.</span> <span data-start="488.19" data-end="491.11">For example, for analytics to know that 50%</span> <span data-start="491.74" data-end="494.41">of visitors to site-two were coming from socialnetwork.com.</span> <span data-start="494.41" data-end="497.62">But full</span> <span data-start="497.75" data-end="500.87">URLs can contain private data and even sensitive</span> <span data-start="500.87" data-end="503.75">or identifying details, especially the path and</span> <span data-start="504.29" data-end="507.63">query string. And requests sent</span> <span data-start="507.63" data-end="509.97">from your websites might include these details.</span> <span data-start="511.93" data-end="515.14">So, onto question one: do I need this data?</span> <span data-start="515.8" data-end="517.77">First, incoming requests.</span> <span data-start="518.6" data-end="521.14">Sometimes, like on this diagram, the Referer is used</span> <span data-start="521.6" data-end="524.69">to extract the origin to see where the request came from</span> <span data-start="524.77" data-end="526.61">or whether its the same origin.</span> </p>
<p><span data-start="527.36" data-end="530.19">But the Referer contains way more data than you need to</span> <span data-start="530.19" data-end="531.28">answer these questions.</span> <span data-start="531.9" data-end="534.62">If you're doing this, you're using it as a proxy to find</span> <span data-start="534.87" data-end="536.99">answers. And this is more work for you.</span> <span data-start="537.58" data-end="539.87">So, we'll look at alternatives in a minute.</span> <span data-start="541.04" data-end="542.87">Second, outgoing requests.</span> <span data-start="543.46" data-end="546.08">If there is no compelling reason for your web site to share</span> <span data-start="546.29" data-end="549.25">full URLs cross-origin, then you shouldn't.</span> <span data-start="549.8" data-end="550.8">We'll see how.</span> <span data-start="551.09" data-end="554.13">OK, on to question two: is there an alternative?</span> <span data-start="555.14" data-end="556.14">Yes.</span> <span data-start="556.43" data-end="558.35">First, incoming requests.</span> <span data-start="559.01" data-end="562.48">Back to what we said. If what you need is just the origin,</span> <span data-start="562.89" data-end="565.31">the Origin header gives you exactly this and it's</span> <span data-start="565.85" data-end="568.36">available in POST and CORS requests.</span> </p>
<p><span data-start="570.36" data-end="573.07">And if what you need to know is whether the request is</span> <span data-start="573.07" data-end="574.78">same-origin, you can use the Sec-Fetch-Site</span> <span data-start="576.11" data-end="579.58">header. Also a side note, if you're using the Referer</span> <span data-start="579.66" data-end="582.37">as extra protection against</span> <span data-start="582.75" data-end="585.75">CSRF, then replacing it with this or</span> <span data-start="585.79" data-end="588.88">Origin is great, but make sure that you're</span> <span data-start="588.88" data-end="590.8">using CSRF tokens and maybe SameSite as</span> <span data-start="591.88" data-end="593.05">a primary protection.</span> <span data-start="594.76" data-end="597.01">Now let's talk about outgoing requests.</span> </p>
<p><span data-start="597.51" data-end="600.47">Is there an alternative to sending the full URL in</span> <span data-start="600.47" data-end="601.47">all requests?</span> <span data-start="601.81" data-end="603.02">Again, yes.</span> <span data-start="603.31" data-end="605.98">Luckily, websites can control how much data is sent in</span> <span data-start="606.31" data-end="608.65">the Referer by sending a specific Referer-Policy.</span> <span data-start="610.48" data-end="613.44">And depending on the policy, either no referer</span> <span data-start="613.61" data-end="616.32">at all, the origin only, or</span> <span data-start="616.66" data-end="618.16">the full URL will be sent.</span> <span data-start="618.95" data-end="619.95">Back to our web sites.</span> <span data-start="620.24" data-end="622.49">Suppose you want the full URL, for example, to</span> <span data-start="623.29" data-end="626.08">understand how users are navigating within your websites.</span> <span data-start="627.37" data-end="630.46">This doesn't mean that you have to send the full URL in all</span> <span data-start="630.46" data-end="631.46">requests.</span> </p>
<p><span data-start="631.75" data-end="635.01">What you can do instead is set your Referer-Policy to</span> <span data-start="635.05" data-end="636.05">strict-origin-when-cross-origin.</span> <span data-start="638.09" data-end="641.47">It shares the full URL for a same-origin requests</span> <span data-start="641.56" data-end="643.43">like here on this diagram, but only the</span> <span data-start="644.64" data-end="646.85">origin in cross-origin requests.</span> <span data-start="647.77" data-end="650.81">Also, it's a safe policy because if from</span> <span data-start="650.81" data-end="653.53">your HTTPS websites, a request to an HTTP origin</span> <span data-start="654.32" data-end="656.82">is sent, the Referer will be stripped.</span> </p>
<p><span data-start="657.11" data-end="659.78">Which is good, because you don't want to leak URLs</span> <span data-start="660.07" data-end="662.83">on an unencrypted connection since anyone in the network</span> <span data-start="662.91" data-end="663.91">can see these, right?</span> <span data-start="664.45" data-end="665.45">And quick segue.</span> <span data-start="666.54" data-end="669.71">If you don't set a policy, the browser's default policy</span> <span data-start="669.71" data-end="671.92">will be used. And to have your back, browsers</span> <span data-start="672.96" data-end="675.59">have switched to or are experimenting with</span> <span data-start="676.01" data-end="678.18">more privacy-preserving default policies.</span> <span data-start="678.43" data-end="680.84">For example, strict-origin-when-cross-origin, the</span> <span data-start="681.55" data-end="682.68">policy we just talked about.</span> <span data-start="683.93" data-end="685.18">You can already try this out.</span> <span data-start="685.22" data-end="687.43">So check the article in the video notes for details.</span> <span data-start="688.77" data-end="690.9">OK, on to question three: have I secured it</span> <span data-start="691.77" data-end="694.73">correctly? strict-origin-when-cross-origin is</span> <span data-start="694.73" data-end="697.61">good, but maybe you can't set this for your whole web site</span> <span data-start="697.9" data-end="700.49">because of some specific use case you might have.</span> </p>
<p><span data-start="701.2" data-end="704.08">In this case, don't fall back to an unsafe policy</span> <span data-start="704.12" data-end="705.12">altogether.</span> <span data-start="705.41" data-end="708.37">What you can do instead is take a case by case approach.</span> <span data-start="708.37" data-end="710.04">For example, set strict-origin-when-cross-origin</span> <span data-start="711.46" data-end="714.67">as a general policy for your website and</span> <span data-start="714.88" data-end="718.34">a more lax policy on specific elements or requests</span> <span data-start="718.38" data-end="720.47">if need be. You need to pick a policy that</span> <span data-start="721.39" data-end="724.6">fits the level of sensitivity of the data and</span> <span data-start="724.64" data-end="726.85">maybe you have a cookie recipes websites, but</span> <span data-start="727.6" data-end="730.39">maybe you have a health care web app and the topic in the</span> <span data-start="730.48" data-end="731.69">path is sensitive.</span> </p>
<p><span data-start="732.31" data-end="735.69">Or some of the URLs contain user identifying</span> <span data-start="735.69" data-end="736.65">information.</span> <span data-start="737.07" data-end="739.95">On the whole, don't share the Referer to a third party</span> <span data-start="739.95" data-end="742.91">unless it's strictly necessary and transparent</span> <span data-start="742.95" data-end="743.99">to your users.</span> </p>
<p><span data-start="744.66" data-end="746.95">And, one last thought, data that might not look</span> <span data-start="747.7" data-end="749.58">sensitive or identifying can bring one</span> <span data-start="750.79" data-end="753.5">more piece to the puzzle and be more revealing than you</span> <span data-start="753.63" data-end="754.63">think.</span> <span data-start="755.63" data-end="756.96">So that it for the Referer.</span> <span data-start="757.3" data-end="758.8">And I think we're through.</span> <span data-start="759.17" data-end="760.59">So, Rowan, you want to wrap up?</span> <span data-start="761.55" data-end="762.76">Thanks. Yeah.</span> <span data-start="762.84" data-end="766.1">OK. Wow. That was a lot of topics in one session.</span> <span data-start="766.47" data-end="769.35">As always, we've got the links included so you can read</span> <span data-start="769.35" data-end="772.02">more on this. To close then, when you're reviewing data</span> <span data-start="772.56" data-end="775.65">usage, whether that cookies, User-Agent, or</span> </p>
<p><span data-start="775.65" data-end="778.65">Referrer or anything else, what are you going</span> <span data-start="778.65" data-end="779.61">to ask yourself?</span> <span data-start="779.86" data-end="781.53">One, do I need this data?</span> <span data-start="782.28" data-end="784.36">Two, is there an alternative?</span> <span data-start="784.7" data-end="786.95">And three, have I secured it correctly?</span> <span data-start="787.62" data-end="790.91">Speaking of needing data, though, what have we got next?</span> <span data-start="791.79" data-end="792.75">Oh, smooth transition.</span> <span data-start="793.71" data-end="796.54">So you definitely need data at sign-up and sign-in,</span> <span data-start="797.25" data-end="798.59">so you got to do these forms right.</span> <span data-start="799.34" data-end="801.97">And Sam's going to explain how to improve sign in</span> <span data-start="802.3" data-end="803.76">and sign up forms on your websites.</span> <span data-start="804.8" data-end="805.8">And we'll see you around!</span> </p>
</section>